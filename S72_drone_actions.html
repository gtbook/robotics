

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>7.2. Multi-rotor Aircraft &#8212; Introduction to Robotics and Perception</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/style.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=UA-312077-7"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'UA-312077-7');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'S72_drone_actions';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="7.3. Sensing for Drones" href="S73_drone_sensing.html" />
    <link rel="prev" title="7.1. Moving in Three Dimensions" href="S71_drone_state.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.png" class="logo__image only-light" alt="Introduction to Robotics and Perception - Home"/>
    <script>document.write(`<img src="_static/logo.png" class="logo__image only-dark" alt="Introduction to Robotics and Perception - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Introduction to Robotics and Perception
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="S10_introduction.html">1. Introduction</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="S11_intro_state.html">1.1. Representing State</a></li>
<li class="toctree-l2"><a class="reference internal" href="S12_intro_actions.html">1.2. Robot Actions</a></li>
<li class="toctree-l2"><a class="reference internal" href="S13_intro_sensing.html">1.3. Sensing</a></li>
<li class="toctree-l2"><a class="reference internal" href="S14_intro_perception.html">1.4. Perception</a></li>
<li class="toctree-l2"><a class="reference internal" href="S15_intro_decision.html">1.5. Planning</a></li>
<li class="toctree-l2"><a class="reference internal" href="S16_intro_learning.html">1.6. Learning</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="S20_sorter_intro.html">2. A Trash Sorting Robot</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="S21_sorter_state.html">2.1. Modeling the World State</a></li>
<li class="toctree-l2"><a class="reference internal" href="S22_sorter_actions.html">2.2. Actions for Sorting Trash</a></li>
<li class="toctree-l2"><a class="reference internal" href="S23_sorter_sensing.html">2.3. Sensors for Sorting Trash</a></li>
<li class="toctree-l2"><a class="reference internal" href="S24_sorter_perception.html">2.4. Perception</a></li>
<li class="toctree-l2"><a class="reference internal" href="S25_sorter_decision_theory.html">2.5. Decision Theory</a></li>
<li class="toctree-l2"><a class="reference internal" href="S26_sorter_learning.html">2.6. Learning</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="S30_vacuum_intro.html">3. A Robot Vacuum Cleaner</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="S31_vacuum_state.html">3.1. Modeling the State of the Vacuum Cleaning Robot</a></li>
<li class="toctree-l2"><a class="reference internal" href="S32_vacuum_actions.html">3.2. Actions over time</a></li>
<li class="toctree-l2"><a class="reference internal" href="S33_vacuum_sensing.html">3.3. Dynamic Bayes Nets</a></li>
<li class="toctree-l2"><a class="reference internal" href="S34_vacuum_perception.html">3.4. Perception with Graphical Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="S35_vacuum_decision.html">3.5. Markov Decision Processes</a></li>
<li class="toctree-l2"><a class="reference internal" href="S36_vacuum_RL.html">3.6. Reinforcement Learning</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="S40_logistics_intro.html">4. Warehouse Robots in 2D</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="S41_logistics_state.html">4.1. Continuous State</a></li>
<li class="toctree-l2"><a class="reference internal" href="S42_logistics_actions.html">4.2. Moving in 2D</a></li>
<li class="toctree-l2"><a class="reference internal" href="S43_logistics_sensing.html">4.3. Sensor Models with Continuous State</a></li>
<li class="toctree-l2"><a class="reference internal" href="S44_logistics_perception.html">4.4. Localization</a></li>
<li class="toctree-l2"><a class="reference internal" href="S45_logistics_planning.html">4.5. Planning for Logistics</a></li>
<li class="toctree-l2"><a class="reference internal" href="S46_logistics_learning.html">4.6. Some System Identification</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="S50_diffdrive_intro.html">5. A Mobile Robot With Simple Kinematics</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="S51_diffdrive_state.html">5.1. State Space for a Differential Drive Robot</a></li>
<li class="toctree-l2"><a class="reference internal" href="S52_diffdrive_actions.html">5.2. Motion Model for the Differential Drive Robot</a></li>
<li class="toctree-l2"><a class="reference internal" href="S53_diffdrive_sensing.html">5.3. Robot Vision</a></li>
<li class="toctree-l2"><a class="reference internal" href="S54_diffdrive_perception.html">5.4. Computer Vision 101</a></li>
<li class="toctree-l2"><a class="reference internal" href="S55_diffdrive_planning.html">5.5. Path Planning</a></li>
<li class="toctree-l2"><a class="reference internal" href="S56_diffdrive_learning.html">5.6. Deep Learning</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="S60_driving_intro.html">6. Autonomous Vehicles</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="S61_driving_state.html">6.1. Planar Geometry</a></li>
<li class="toctree-l2"><a class="reference internal" href="S62_driving_actions.html">6.2. Kinematics for Driving</a></li>
<li class="toctree-l2"><a class="reference internal" href="S63_driving_sensing.html">6.3. Sensing for Autonomous Vehicles</a></li>
<li class="toctree-l2"><a class="reference internal" href="S64_driving_perception.html">6.4. SLAM</a></li>
<li class="toctree-l2"><a class="reference internal" href="S65_driving_planning.html">6.5. Planning for Autonomous Driving.</a></li>
<li class="toctree-l2"><a class="reference internal" href="S66_driving_DRL.html">6.6. Deep Reinforcement Learning</a></li>
</ul>
</li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="S70_drone_intro.html">7. Autonomous Drones in 3D</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-7"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="S71_drone_state.html">7.1. Moving in Three Dimensions</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">7.2. Multi-rotor Aircraft</a></li>
<li class="toctree-l2"><a class="reference internal" href="S73_drone_sensing.html">7.3. Sensing for Drones</a></li>
<li class="toctree-l2"><a class="reference internal" href="S74_drone_perception.html">7.4. Visual SLAM</a></li>
<li class="toctree-l2"><a class="reference internal" href="S75_drone_planning.html">7.5. Trajectory Optimization</a></li>
</ul>
</li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/gtbook/robotics" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/gtbook/robotics/issues/new?title=Issue%20on%20page%20%2FS72_drone_actions.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/S72_drone_actions.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Multi-rotor Aircraft</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#drone-dynamics">7.2.1. Drone Dynamics</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#hover">7.2.1.1. Hover</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#forward-flight">7.2.1.2. Forward Flight</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#maximum-tilt-and-thrust">7.2.1.3. Maximum Tilt and Thrust</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#drag-and-maximum-velocity">7.2.1.4. Drag and Maximum Velocity</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#drone-kinematics">7.2.2. Drone Kinematics</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#positional-kinematics">7.2.2.1. Positional Kinematics</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#angular-velocity">7.2.2.2. Angular Velocity</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise">7.2.2.2.1. Exercise</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#rotational-kinematics">7.2.2.3. Rotational Kinematics</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#simulation-aka-forward-integrating">7.2.3. Simulation aka Forward Integrating</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#integrating-position">7.2.3.1. Integrating Position</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#integrating-attitude">7.2.3.2. Integrating Attitude</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#an-example-in-code">7.2.4. An Example in Code</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercises">7.2.4.1. Exercises</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#full-rigid-body-dynamics">7.2.5. Full Rigid-Body Dynamics</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#gyroscopic-effects">7.2.5.1. Gyroscopic effects</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#generating-force-and-torque">7.2.5.2. Generating Force and Torque</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">7.2.5.2.1. Exercises</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#putting-it-all-together">7.2.5.3. Putting it all together</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">7.2.5.4. Exercises:</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <p><a href="https://colab.research.google.com/github/gtbook/robotics/blob/main/S72_drone_actions.ipynb" target="_parent"><img alt="Open In Colab" src="https://colab.research.google.com/assets/colab-badge.svg" /></a></p>
<section class="tex2jax_ignore mathjax_ignore" id="multi-rotor-aircraft">
<h1><span class="section-number">7.2. </span>Multi-rotor Aircraft<a class="headerlink" href="#multi-rotor-aircraft" title="Permalink to this heading">#</a></h1>
<blockquote>
<div><p>Using four rotors to fly in 3D.</p>
</div></blockquote>
<a class="reference internal image-reference" href="_images/S72-Autonomous_camera_drone-06.jpg"><img alt="Splash image with steampunk drone in various poses" class="align-center" src="_images/S72-Autonomous_camera_drone-06.jpg" style="width: 40%;" /></a>
<p>The dynamics and kinematics of quadrotors and in general <em>multi</em>-rotor aircraft are those of simple rigid 3D bodies. Many different coordinate frame conventions are used in the literature. We introduce one good choice below, and convert equations from the literature to this convention where needed.</p>
<p>The equations for control and navigation we develop below are most useful when expressed in a local <strong>navigation frame</strong> <span class="math notranslate nohighlight">\(N\)</span>. For MAV applications this frame is almost always assumed to be non-rotating and aligned with gravity, but can otherwise be defined arbitrarily.
For example, the <strong>East-North-Up (ENU)</strong> convention defines the <span class="math notranslate nohighlight">\(x, y\)</span> and <span class="math notranslate nohighlight">\(z\)</span> axes along
the east, north, and upward directions, respectively.
The origin of the navigation frame is often chosen as the take-off point.
Another choice is the UTM (Universal Transverse Mercator) coordinate system, which defines 60 locally flat coordinate frames on earth.</p>
<p>We also define a <strong>body frame</strong> <span class="math notranslate nohighlight">\(B\)</span> as having its origin at the center of mass of the vehicle. We fix the X-axis as pointing to the front of the vehicle (not always the direction of travel), the Y-axis as pointing to the left, and the Z-axis pointing up, the so-called <strong>FLU convention</strong>. In aerospace applications the so-called FRD convention with the Z-axis <em>down</em> is also popular, but it really is just matter of choice, and we find FLU to be more intuitive.</p>
<p>We then define, respectively,</p>
<p>• the vehicle’s <em>position</em> <span class="math notranslate nohighlight">\(r^{n}\doteq[x,y,z]^{T}\)</span>,</p>
<p>• its linear velocity <span class="math notranslate nohighlight">\(v^n=\dot{r^{n}}\doteq[u,v,w]^{T}\)</span>,</p>
<p>• the attitude <span class="math notranslate nohighlight">\(R^n_b\doteq[\hat{x}^n_b,\hat{y}^n_b,\hat{z}^n_b]\in SO(3)\)</span>, a <span class="math notranslate nohighlight">\(3\times 3\)</span> rotation matrix with the columns of the body frame <span class="math notranslate nohighlight">\(B\)</span> expressed in the navigation frame <span class="math notranslate nohighlight">\(N\)</span>,</p>
<p>• the body angular velocity <span class="math notranslate nohighlight">\(\omega^b\doteq[p,q,r]^{T}\)</span>.</p>
<p>Above the superscript <span class="math notranslate nohighlight">\(n\)</span> and <span class="math notranslate nohighlight">\(b\)</span> denote quantities expressed in the <em>navigation</em> and <em>body</em> frame, respectively. Together, these quantities allow us to talk about the <em>kinematics</em> of the drone: where it is and how it moves over time.</p>
<section id="drone-dynamics">
<h2><span class="section-number">7.2.1. </span>Drone Dynamics<a class="headerlink" href="#drone-dynamics" title="Permalink to this heading">#</a></h2>
<p>Kinematics alone is not enough, however: because an MAV has <em>mass</em>, we need to talk about how forces will bring about change in the velocity. One of us (Dellaert) has worked at the drone startup <a class="reference external" href="https://www.skydio.com/">Skydio</a> and hence we will use one of its products as a prototypical example.</p>
<figure id="fig:Skydio">
<img src="https://github.com/gtbook/robotics/blob/main/Figures7/Skydio2axes.png?raw=1" style="width:18cm" alt="">
<figcaption>Skydio 2 drone with *Front-Left-Up* coordinate frame, and rotors labeled with coordinates. </figcaption>
</figure>
<p>In particular, let us take the <a class="reference external" href="https://www.skydio.com/skydio-2-plus">Skydio 2+</a> as a relevant example. Its mass, with battery, is about <span class="math notranslate nohighlight">\(800g\)</span>, but let’s just say <span class="math notranslate nohighlight">\(1kg\)</span> to make the calculations easier. Its dimensions are <span class="math notranslate nohighlight">\(229mm \times 274mm\)</span>, but let us assume the motors are at <span class="math notranslate nohighlight">\((+/- 0.10m, +/- 0.10m)\)</span>, which is not too far off. The figure above shows the setup.</p>
<section id="hover">
<h3><span class="section-number">7.2.1.1. </span>Hover<a class="headerlink" href="#hover" title="Permalink to this heading">#</a></h3>
<p>We denote by <span class="math notranslate nohighlight">\(f_i \in \mathbb{R}\)</span> the amount of thrust provided by the <span class="math notranslate nohighlight">\(i^{th}\)</span> rotor.
This thrust is applied in the direction of the <span class="math notranslate nohighlight">\(z\)</span>-axis of the body frame.
To hover, assuming we approximate the local gravity constant as <span class="math notranslate nohighlight">\(g=10m/s^2\)</span>, the four rotors <em>together</em> must provide a thrust of 10N upwards to compensate for gravity, i.e., 2.5N per motor.
Of course, we need to be able to accelerate upwards, so let’s assume each motor can provide up to double that, i.e., 0 to 5N.
If the drone is level (i.e., the body <span class="math notranslate nohighlight">\(z\)</span>-axis is aligned with the direction of gravity), here are some sample accelerations we can deliver:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(f_i=0N\)</span> for <span class="math notranslate nohighlight">\(i\in{1..4}\)</span>: downwards acceleration at <span class="math notranslate nohighlight">\(-10\frac{m}{s^2}\)</span>.</p></li>
<li><p><span class="math notranslate nohighlight">\(f_i=2.5N\)</span> for <span class="math notranslate nohighlight">\(i\in{1..4}\)</span>: stable hover.</p></li>
<li><p><span class="math notranslate nohighlight">\(f_i=5N\)</span> for <span class="math notranslate nohighlight">\(i\in{1..4}\)</span>: upwards acceleration at <span class="math notranslate nohighlight">\(10\frac{m}{s^2}\)</span>.</p></li>
</ul>
<p>In general, the total force <span class="math notranslate nohighlight">\(F^b \in \mathbb{R}^3\)</span> delivered by the rotors is aligned with the body Z-axis and is equal to</p>
<div class="math notranslate nohighlight">
\[\begin{split}
F^b
=
\begin{bmatrix}0 \\ 0 \\ F^b_z\end{bmatrix}
= \sum_{i=1}^4 \begin{bmatrix}0 \\ 0 \\ 1\end{bmatrix} f_i.
\end{split}\]</div>
<p>As long as the drone is level, and hence the body <span class="math notranslate nohighlight">\(z\)</span>-axis is aligned with gravity, we can only accelerate up or down. The net acceleration in that case is obtained simply by subtracting the acceleration due to gravity. But, of course, only being to move up or down is not very useful, and is unlikely to happen anyway because of noise, wind, and other effects. Hence, below we look at how 3D orientation plays a role.</p>
</section>
<section id="forward-flight">
<h3><span class="section-number">7.2.1.2. </span>Forward Flight<a class="headerlink" href="#forward-flight" title="Permalink to this heading">#</a></h3>
<p>The thrust delivered by the rotors is always aligned with the body frame’s <span class="math notranslate nohighlight">\(z\)</span>-axis, and hence by rotating the quadrotor appropriately we can achieve any thrust direction in the navigation frame that we desire.
For example, when the quadrotor <em>tilts</em> forward, some of the thrust delivered by the rotors
will be directed toward generating horizontal acceleration.
To get a handle on this, we need to calculate the thrust in the <em>navigation</em> frame <span class="math notranslate nohighlight">\(Nn\)</span>. This is accomplished by multiplying the 3D force <span class="math notranslate nohighlight">\(F^b\)</span> in the body frame with the rotation matrix <span class="math notranslate nohighlight">\(R^n_b\)</span>:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
F^n = R^n_b \begin{bmatrix}0 \\ 0 \\ F^b_z\end{bmatrix} = \hat{z}^n_b F^b_z.
\end{split}\]</div>
<p>Above <span class="math notranslate nohighlight">\(\hat{z}^n_b\)</span> is the third column of <span class="math notranslate nohighlight">\(R^n_b\)</span>, i.e., this is simply the <span class="math notranslate nohighlight">\(z\)</span>-axis of the body frame expressed in the navigation frame.</p>
<p>As an example, let us assume that the Forward/<span class="math notranslate nohighlight">\(x\)</span>-axis of the FLU body frame is currently oriented along the
North/<span class="math notranslate nohighlight">\(y\)</span>-axis of the ENU navigation frame, i.e., we are flying north. Then, if we tilt the body’s Up/<span class="math notranslate nohighlight">\(z\)</span>-axis forward by an angle of <span class="math notranslate nohighlight">\(\theta\)</span> with respect to vertical, the body <span class="math notranslate nohighlight">\(z\)</span>-axis will have a <span class="math notranslate nohighlight">\(\sin \theta\)</span> contribution towards the north (ENU <span class="math notranslate nohighlight">\(y\)</span>-axis), and a <span class="math notranslate nohighlight">\(\cos \theta\)</span> up (ENU <span class="math notranslate nohighlight">\(z\)</span>-axis):</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\hat{z}^n_b = \begin{bmatrix}0 \\ \sin \theta \\ \cos \theta\end{bmatrix}.
\end{split}\]</div>
<p>The thrust <em>vector</em> <span class="math notranslate nohighlight">\(F^n\)</span> in the navigation frame is then obtained by multiplying with the total force <span class="math notranslate nohighlight">\(F^b_z\)</span>:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
F^n = \begin{bmatrix}0 \\ \sin \theta \\ \cos \theta\end{bmatrix} F^b_z.
\end{split}\]</div>
<p>The fact that <span class="math notranslate nohighlight">\(\cos \theta&lt;1\)</span> is potentially problematic: if we want to maintain level flight (not fall out of the sky!) we need to compensate for gravity by maintaining the constraint</p>
<div class="math notranslate nohighlight">
\[
F^b_z \cos \theta  = 10.
\]</div>
<p>That in turn means that the forward trust (along the navigation Y-axis) will be</p>
<div class="math notranslate nohighlight">
\[
F^n_y = F^b_z  \sin \theta = \frac{10}{\cos \theta} \sin \theta  = 10 \tan \theta  
\]</div>
<p>This point bears repeating: if we tilt the drone to fly in a particular direction, the upward component of the thrust vector decreases, so we will have to <em>increase</em> total thrust, or we will lose altitude.</p>
</section>
<section id="maximum-tilt-and-thrust">
<h3><span class="section-number">7.2.1.3. </span>Maximum Tilt and Thrust<a class="headerlink" href="#maximum-tilt-and-thrust" title="Permalink to this heading">#</a></h3>
<p>We can expand on this example to calculate what our maximum tilt angle would be, given bounded thrust. We are constrained by the maximum thrust <span class="math notranslate nohighlight">\(F^b_z\)</span> we can deliver, which we assumed to be 20N above. Imposing this constraint in turn yields a constraint on <span class="math notranslate nohighlight">\(\cos \theta\)</span>:</p>
<div class="math notranslate nohighlight">
\[
F^b_z = \frac{10N}{\cos \theta} \leq 20N \rightarrow \cos \theta \geq 0.5
\]</div>
<p>From that we can deduce that the maximum tilt angle <span class="math notranslate nohighlight">\(\theta\)</span> is 60 degrees:</p>
<div class="math notranslate nohighlight">
\[
-60^\circ \leq \theta \leq 60^\circ
\]</div>
<p>At that maximum tilt angle, we have</p>
<div class="math notranslate nohighlight">
\[
F^n_y = 10 \tan \theta_{\max} \approx 17
\]</div>
<p>So, we are limited to <span class="math notranslate nohighlight">\(17N\)</span> of forward thrust, and this when tilting very aggressively at 60 degrees. If we tilt more, we can improve thrust even more (up to 20N) but the drone will quickly lose altitude.</p>
</section>
<section id="drag-and-maximum-velocity">
<h3><span class="section-number">7.2.1.4. </span>Drag and Maximum Velocity<a class="headerlink" href="#drag-and-maximum-velocity" title="Permalink to this heading">#</a></h3>
<p>When drones fly through the air, they encounter air resistance, also known as <strong>drag</strong>, which
can be understood as a force that acts opposite to the motion of the drone.
Because of drag, constant forward thrust does <em>not</em> mean that the drone will continue accelerating.
From the spec-sheet of the Skydio 2 drone we can see that the top speed in autonomous mode is 36Mph,
which is about <span class="math notranslate nohighlight">\(16m/s\)</span>, while the theoretical top speed is probably more like <span class="math notranslate nohighlight">\(20m/s\)</span>.
For air vehicles, the <strong>drag coefficient</strong>, which we denote by <span class="math notranslate nohighlight">\(k_d\)</span>,
relates the vehicle speed to this resistive force.
From physics we know that drag increases <em>quadratically</em> with velocity.
Indeed, the drag force <span class="math notranslate nohighlight">\(k_d v_{top}^2\)</span> at the top speed will exactly balance the maximum forward thrust of 17N:</p>
<div class="math notranslate nohighlight">
\[
k_d v_{top}^2 = 17
\]</div>
<p>If we assume the top speed of <span class="math notranslate nohighlight">\(20m/s\)</span> is correct, we can estimate the drag coefficient <span class="math notranslate nohighlight">\(k_d\)</span>:</p>
<div class="math notranslate nohighlight">
\[
k_d 20^2= 17 \rightarrow k_d = 0.0425
\]</div>
<p>Given the drag coefficient <span class="math notranslate nohighlight">\(k_d\)</span>, we can calculate a simple mapping from tilt angle <span class="math notranslate nohighlight">\(\theta\)</span> to the terminal forward velocity. For a given tilt angle <span class="math notranslate nohighlight">\(\theta\)</span> we first calculate the forward thrust <span class="math notranslate nohighlight">\(F^n_y\)</span> in the navigation frame:</p>
<div class="math notranslate nohighlight">
\[
F^n_y = \tan \theta \cdot 10N
\]</div>
<p>after which the velocity can be obtained by equating that to the drag force <span class="math notranslate nohighlight">\(k_d v^2\)</span>:</p>
<div class="math notranslate nohighlight">
\[
\tan \theta \cdot 10N = k_d v^2 \rightarrow v = \sqrt{\frac{\tan \theta \cdot 10}{k_d}}
\]</div>
<p>Plugging in the estimated value of <span class="math notranslate nohighlight">\(k_d\)</span> we obtain</p>
<div class="math notranslate nohighlight">
\[
v \approx 15 \sqrt{\tan \theta}
\]</div>
<p>With a smidgen of code we can build a lookup table <code class="docutils literal notranslate"><span class="pre">vmap</span></code> …</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">vmap</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">theta_deg</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">40</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span> <span class="mi">60</span><span class="p">]:</span>
  <span class="n">theta_rad</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">theta_deg</span><span class="p">)</span>
  <span class="n">vmap</span><span class="p">[</span><span class="n">theta_deg</span><span class="p">]</span> <span class="o">=</span> <span class="mf">15.</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">theta_rad</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>…and plot it below:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#| caption: Velocity vs. Pitch Angle.</span>
<span class="c1">#| label: fig:v_vs_theta</span>
<span class="n">px</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">vmap</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="n">y</span><span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">vmap</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Velocity vs. Pitch Angle&quot;</span><span class="p">,</span>
        <span class="n">labels</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span><span class="s2">&quot;Pitch Angle (deg)&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span><span class="s2">&quot;Velocity (m/s)&quot;</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/277cbf0c5dd469eac95b175c57a6c0db330494e500dd6b85ecea93f1ad0a8c8e.png" src="_images/277cbf0c5dd469eac95b175c57a6c0db330494e500dd6b85ecea93f1ad0a8c8e.png" />
</div>
</div>
</section>
</section>
<section id="drone-kinematics">
<h2><span class="section-number">7.2.2. </span>Drone Kinematics<a class="headerlink" href="#drone-kinematics" title="Permalink to this heading">#</a></h2>
<p>The subject of <strong>kinematics</strong> deals exclusively with positions and velocities, not the forces and accelerations involved to obtain those velocities. Kinematics should be contrasted with <strong>statics</strong> or steady-state force reasoning as we did above, and <strong>dynamics</strong> which describes the changing forces and accelerations over time.</p>
<section id="positional-kinematics">
<h3><span class="section-number">7.2.2.1. </span>Positional Kinematics<a class="headerlink" href="#positional-kinematics" title="Permalink to this heading">#</a></h3>
<p>For position, the vehicle’s kinematics are straightforward. The time derivative <span class="math notranslate nohighlight">\(\dot{r}^{n}\)</span> of position <span class="math notranslate nohighlight">\(r^n\)</span> in the navigation frame <span class="math notranslate nohighlight">\(N\)</span> is equal to the <strong>linear velocity</strong> <span class="math notranslate nohighlight">\(v^n\)</span>, also in the navigation frame:</p>
<div class="math notranslate nohighlight">
\[
\dot{r}^{n}	= v^n.
\]</div>
</section>
<section id="angular-velocity">
<h3><span class="section-number">7.2.2.2. </span>Angular Velocity<a class="headerlink" href="#angular-velocity" title="Permalink to this heading">#</a></h3>
<p>Just as we have a linear velocity <span class="math notranslate nohighlight">\(v^n\)</span>, a three-vector, we also have a 3-dimensional <strong>angular velocity</strong> <span class="math notranslate nohighlight">\(\omega\)</span>,
which is typically given <em>in the body frame</em> as <span class="math notranslate nohighlight">\(\omega^b\)</span>.
In this case, the components of <span class="math notranslate nohighlight">\(\omega^b\)</span> correspond to angular velocities around the respective body axes.
This angular velocity vector has a very intuitive interpretation as an angle-axis interpretation: the vector can be viewed as a rotation axis in 3D, centered at the body coordinate frame, and its norm <span class="math notranslate nohighlight">\(\|\omega^b\|\)</span> is the instantaneous angular speed around that axis.</p>
<p>For example, the drone steadily pitching downward by 10 degrees/second corresponds to a positive rotation around the body <span class="math notranslate nohighlight">\(y\)</span>-axis and the corresponding angular velocity is given by</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\omega^b = \begin{bmatrix}0 \\ 1 \\ 0\end{bmatrix} 10 .
\end{split}\]</div>
<p>We use the <em>right hand rule</em>,
which defines the a positive direction of angular velocity around a given axis is defined as counter-clockwise.
Remember that in our FLU convention the <span class="math notranslate nohighlight">\(y\)</span>-axis points leftward from the center of the drone, and hence looking from the left a counter-clockwise movement corresponds to pitching <em>down</em>.</p>
<p>In an FLU body frame, each of the axes is associated with a particular rotational motion:</p>
<ul class="simple">
<li><p><strong>roll</strong> is around the Forward/<span class="math notranslate nohighlight">\(x\)</span>-axis. Positive roll is to the right.</p></li>
<li><p><strong>pitch</strong> is around the Left/<span class="math notranslate nohighlight">\(y\)</span>-axis. Positive pitch is downward.</p></li>
<li><p><strong>yaw</strong> is around the Up/<span class="math notranslate nohighlight">\(z\)</span>-axis. Positive yaw is towards the left.</p></li>
</ul>
<p>Note that the statements associated with positive roll, pitch or yaw above are valid only when starting from upright hover. For example, when flying upside down, obviously yaw and pitch would behave oppositely.</p>
<section id="exercise">
<h4><span class="section-number">7.2.2.2.1. </span>Exercise<a class="headerlink" href="#exercise" title="Permalink to this heading">#</a></h4>
<p>When flying upside down but in the same direction, positive roll is still to the right. Think about it.</p>
</section>
</section>
<section id="rotational-kinematics">
<h3><span class="section-number">7.2.2.3. </span>Rotational Kinematics<a class="headerlink" href="#rotational-kinematics" title="Permalink to this heading">#</a></h3>
<p>We can use rotation matrices to generalize the example above to arbitrary angular velocities.
In Section 7.1 we have seen that <span class="math notranslate nohighlight">\(\omega^b\)</span> denotes the angular velocity of the body frame
expressed in the coordinates relative to the body frame.
Therefore, using the results from Section 7.1, we have</p>
<div class="math notranslate nohighlight">
\[
\dot{R}^n_b	= \hat{\omega}^n R^n_b
\]</div>
<p>and</p>
<div class="math notranslate nohighlight">
\[ \hat{\omega}^b = \left( R^n_b \right)^T \hat{\omega}^n \]</div>
<p>The quantity <span class="math notranslate nohighlight">\(\hat{\omega}^b\)</span> is a <span class="math notranslate nohighlight">\(3\times 3\)</span> skew-symmetric matrix, related to the angular velocity <span class="math notranslate nohighlight">\(\omega^b\)</span> as follows:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\hat{\omega}^b\doteq\begin{bmatrix}
0 &amp; -\omega^b_{z} &amp; \omega^b_{y}\\
\omega^b_{z} &amp;  0&amp; -\omega^b_{x}\\
-\omega^b_{y} &amp; \omega^b_{x} &amp;0
\end{bmatrix}.
\end{split}\]</div>
<p>As a reminder, as discussed in Section 7.1, <span class="math notranslate nohighlight">\(\hat{\omega}^b\in \mathfrak{so}(3)\)</span>, the Lie algebra associated with the 3D rotation group <span class="math notranslate nohighlight">\(SO(3)\)</span>.</p>
<p>Regardless of whether we express the angular velocity with respect to
the navigation or body frame,
the time derivative <span class="math notranslate nohighlight">\(\dot{R}^n_b\)</span> of the <span class="math notranslate nohighlight">\(3\times 3\)</span> attitude (rotation matrix) <span class="math notranslate nohighlight">\(R^n_b\)</span> is not very intuitive.
In the next section we show how to integrate it over time to simulate or calculate the trajectory of the drone over time.</p>
</section>
</section>
<section id="simulation-aka-forward-integrating">
<h2><span class="section-number">7.2.3. </span>Simulation aka Forward Integrating<a class="headerlink" href="#simulation-aka-forward-integrating" title="Permalink to this heading">#</a></h2>
<p>Assuming we know the drone’s velocity, we can calculate its position over time. More formally, if time histories <span class="math notranslate nohighlight">\(v^n(t)\)</span> and <span class="math notranslate nohighlight">\(\omega^b(t)\)</span> for the linear and angular velocities are available, the vehicle’s position <span class="math notranslate nohighlight">\(r^{n}(t)\)</span> and attitude <span class="math notranslate nohighlight">\(R^n_b(t)\)</span> can be integrated forward using the following two equations:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{aligned}
r^n_{k+1} &amp;= r^n_{k} + d^k_{k+1}(v^n(t), \Delta t)\\
R^n_{b,k+1} &amp;= R^n_{b,k} R^k_{k+1}(\omega^b(t), \Delta t)
\end{aligned}
\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(\Delta t\)</span> is the sample time and the index <span class="math notranslate nohighlight">\(k\)</span> refers to discretized times <span class="math notranslate nohighlight">\(t_k\)</span>, spaced <span class="math notranslate nohighlight">\(\Delta t\)</span> apart. Above we have conveniently used two magic functions <span class="math notranslate nohighlight">\(d^k_{k+1}(\cdot)\)</span> and <span class="math notranslate nohighlight">\(R^k_{k+1}(\cdot)\)</span>, defined below:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(d^k_{k+1}(v^n(t), \Delta t)\)</span> computes the relative displacement obtained by exactly integrating the time-varying velocity <span class="math notranslate nohighlight">\(v^n(t)\)</span> over the interval <span class="math notranslate nohighlight">\((t_k,t_{k+1}]\)</span>, and</p></li>
<li><p><span class="math notranslate nohighlight">\(R^k_{k+1}(\omega^b(t), \Delta t)\)</span> computes the relative rotation obtained by exactly integrating the time-varying angular velocity <span class="math notranslate nohighlight">\(\omega^b(t)\)</span> over that same interval.</p></li>
</ul>
<p>Exactly integrating a time-varying quantity is not easy, however, so these abstract function definitions only get us so far. Below we see how to implement this <em>in practice</em>.</p>
<section id="integrating-position">
<h3><span class="section-number">7.2.3.1. </span>Integrating Position<a class="headerlink" href="#integrating-position" title="Permalink to this heading">#</a></h3>
<p>The above is exact, but when implementing this in code we need to use a numerical integration scheme. For position, the simplest integration scheme is the <strong>forward Euler method</strong></p>
<div class="math notranslate nohighlight">
\[
d^k_{k+1}(v^n(t), \Delta t) \approx v^n(t_k) \Delta t
\]</div>
<p>which approximates velocity <span class="math notranslate nohighlight">\(v^n(t)\)</span> over the interval <span class="math notranslate nohighlight">\((t_k,t_{k+1}]\)</span> as constant with value <span class="math notranslate nohighlight">\(v^n(t_k)\)</span>. Of course, this is just an approximation, and its quality depends both on the time step <span class="math notranslate nohighlight">\(\Delta t\)</span> (smaller is better) and on the nature of the trajectory (smoother is better).</p>
<p>The forward Euler method is not the only possible integration scheme. There is also the <strong>backward Euler method</strong>, which uses <span class="math notranslate nohighlight">\(v^n(t_{k+1})\)</span>, and the <strong>trapezoidal method</strong>, which uses the average <span class="math notranslate nohighlight">\(0.5v^n(t_k)+0.5v^n(t_{k+1})\)</span>. More sophisticated integration schemes are possible, allowing for larger sample times <span class="math notranslate nohighlight">\(\Delta t\)</span>, but they require more function evaluations of the velocity.</p>
</section>
<section id="integrating-attitude">
<h3><span class="section-number">7.2.3.2. </span>Integrating Attitude<a class="headerlink" href="#integrating-attitude" title="Permalink to this heading">#</a></h3>
<p>For the attitude part, it turns out that the equivalent forward Euler method can be implemented <em>in closed form</em> using <strong>Rodrigues’ rotation formula</strong>, which states that the rotation matrix
corresponding to a rotation by angle <span class="math notranslate nohighlight">\(\theta\)</span> about a unit vector <span class="math notranslate nohighlight">\(K\)</span> is given
by</p>
<div class="math notranslate nohighlight">
\[
R =  I + \sin\theta \hat{K} + (1-\cos\theta) \hat{K}^2
\]</div>
<p>To apply this to our problem of integrating angular velocity at time <span class="math notranslate nohighlight">\(k\)</span>
we define <span class="math notranslate nohighlight">\(K\)</span> to be the unit vector <span class="math notranslate nohighlight">\(\omega^b_k /\|\omega^b_k\|\)</span>, and <span class="math notranslate nohighlight">\(\theta=\|\omega^b_k\| \Delta t\)</span> as the amount of rotation over the <span class="math notranslate nohighlight">\(\Delta t\)</span> interval.
This is equivalent to approximating the total rotation during the interval <span class="math notranslate nohighlight">\(\Delta t\)</span>
by the constant angle <span class="math notranslate nohighlight">\(\theta\)</span>,
and leads to the following approximation for the corresponding rotation matrix:</p>
<div class="math notranslate nohighlight">
\[
R^k_{k+1}(\omega^b(t), \Delta t) \approx I + \sin\theta \hat{K} + (1-\cos\theta) \hat{K}^2
\]</div>
<p>Again, note that this only an approximation because it is after all an Euler step: it is only exact if the time-varying angular velocity <span class="math notranslate nohighlight">\(\omega^b(t)\)</span> is actually constant over the interval.</p>
<p>The last term in Rodrigues’ formula is typically small for small sample times <span class="math notranslate nohighlight">\(\Delta t\)</span> because (a) <span class="math notranslate nohighlight">\((1-\cos\theta)\)</span> is small for small <span class="math notranslate nohighlight">\(\theta\)</span>, and (b) the matrix <span class="math notranslate nohighlight">\(\hat{K}^2\)</span> contains squares of numbers smaller than 1. Hence, an often-used first-order approximation for Euler’s method in rotation spaces is</p>
<div class="math notranslate nohighlight">
\[\begin{split}
R^k_{k+1}(\omega^b(t), \Delta t) \approx I + \sin\theta \hat{K} \approx I + \hat{\omega}^b_k \Delta t =
\begin{bmatrix}
1 &amp; -\omega^b_{z}\Delta t  &amp; \omega^b_{y}\Delta t \\
\omega^b_{z}\Delta t  &amp; 1 &amp; -\omega^b_{x}\Delta t \\
-\omega^b_{y}\Delta t  &amp; \omega^b_{x}\Delta t  &amp; 1
\end{bmatrix}
\end{split}\]</div>
<p>where we also used the small angle approximation <span class="math notranslate nohighlight">\(\sin \theta \approx \theta\)</span>.
Note that strictly speaking this approximation (unlike Rodrigues’ formula) departs the rotation manifold and we need to re-normalize to ensure that the attitude <span class="math notranslate nohighlight">\(R^n_b\)</span> remains a proper orthonormal rotation matrix, i.e., <span class="math notranslate nohighlight">\(R^n_b\in SO(3)\)</span>.</p>
<p>So, finally, we have a simple to implement approximation of the attitude integration step:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
R^n_{b,k+1} = R^n_{b,k} R^k_{k+1}(\omega^b(t), \Delta t) 
\approx R^n_{b,k} 
\begin{bmatrix}
1 &amp; -\omega^b_{z}\Delta t  &amp; \omega^b_{y}\Delta t \\
\omega^b_{z}\Delta t  &amp; 1 &amp; -\omega^b_{x}\Delta t \\
-\omega^b_{y}\Delta t  &amp; \omega^b_{x}\Delta t  &amp; 1
\end{bmatrix}
\end{split}\]</div>
</section>
</section>
<section id="an-example-in-code">
<h2><span class="section-number">7.2.4. </span>An Example in Code<a class="headerlink" href="#an-example-in-code" title="Permalink to this heading">#</a></h2>
<p>Given the above, simulating the kinematics of a drone in code is not that hard. We can capture the math in a simple class. We use a python <code class="docutils literal notranslate"><span class="pre">dataclass</span></code> which is easy to initialize, and perform Euler integration in the <code class="docutils literal notranslate"><span class="pre">integrate</span></code> method:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">DroneKinematics</span><span class="p">:</span>
    <span class="n">rn</span><span class="p">:</span> <span class="n">gtsam</span><span class="o">.</span><span class="n">Point3</span>
    <span class="n">vn</span><span class="p">:</span> <span class="n">gtsam</span><span class="o">.</span><span class="n">Point3</span>
    <span class="n">nRb</span><span class="p">:</span> <span class="n">gtsam</span><span class="o">.</span><span class="n">Rot3</span>
    <span class="n">wb</span><span class="p">:</span> <span class="n">gtsam</span><span class="o">.</span><span class="n">Point3</span>

    <span class="k">def</span> <span class="nf">pose</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the current pose of the drone.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">gtsam</span><span class="o">.</span><span class="n">Pose3</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nRb</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rn</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">integrate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dt</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Integrate the drone position/attitude forward in time by dt seconds.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rn</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vn</span> <span class="o">*</span> <span class="n">dt</span>  <span class="c1"># integrate position</span>
        <span class="c1"># calculate incremental rotation matrix using the exponential map</span>
        <span class="n">dR</span> <span class="o">=</span> <span class="n">gtsam</span><span class="o">.</span><span class="n">Rot3</span><span class="o">.</span><span class="n">Expmap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wb</span> <span class="o">*</span> <span class="n">dt</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nRb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nRb</span> <span class="o">*</span> <span class="n">dR</span>  <span class="c1"># integrate attitude</span>
</pre></div>
</div>
</div>
</div>
<p>Above, the <code class="docutils literal notranslate"><span class="pre">Rot3.Expmap</span></code>, for “exponential map”, implements Rodrigues’ formula exactly.
The approach is based on the exponential form of Rodrigues’ formula:</p>
<div class="math notranslate nohighlight">
\[
\exp ( \theta \hat{K}) \doteq I + \sin\theta \hat{K} + (1-\cos\theta) \hat{K}^2
\]</div>
<p>which relies on the <em>exponential map</em> from <span class="math notranslate nohighlight">\(\mathfrak{so}(3)\)</span>
to <span class="math notranslate nohighlight">\(SO(3)\)</span>, a concept that generalizes to other Lie groups.</p>
<p>Note that the <code class="docutils literal notranslate"><span class="pre">*</span></code> operator is overloaded in gtsam to properly compose 3D rotations.</p>
<p>We demonstrate the above by forward integrating a quadrotor’s position and orientation starting from a “forward flight” configuration at the origin, i.e., pitched forward by 10 degrees. We first specify the attitude using <code class="docutils literal notranslate"><span class="pre">Rot3.Pitch</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nRb0</span> <span class="o">=</span> <span class="n">gtsam</span><span class="o">.</span><span class="n">Rot3</span><span class="o">.</span><span class="n">Pitch</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">nRb0</span><span class="o">.</span><span class="n">matrix</span><span class="p">(),</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[[ 0.98  0.    0.17]
 [ 0.    1.    0.  ]
 [-0.17  0.    0.98]]
</pre></div>
</div>
</div>
</div>
<p>Note that the forward <span class="math notranslate nohighlight">\(x\)</span>-axis (first column) is pointed slightly down, the <span class="math notranslate nohighlight">\(y\)</span>-axis is level, and the <span class="math notranslate nohighlight">\(z\)</span>-axis is pointed up but slightly forward. This time we are flying in the direction of the navigation <span class="math notranslate nohighlight">\(x\)</span>-axis, i.e., <em>eastward</em> in the ENU convention. We have calculated before that the velocity at this angle is <span class="math notranslate nohighlight">\(6~m/s\)</span>.</p>
<p>Let us also assume that the 4 rotors conspire to create an angular velocity <span class="math notranslate nohighlight">\(\omega^b\)</span> around the vertical body axis of 10 degrees/second:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">vb</span> <span class="o">=</span> <span class="n">gtsam</span><span class="o">.</span><span class="n">Point3</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>                <span class="c1"># body velocity</span>
<span class="n">wb</span> <span class="o">=</span> <span class="n">gtsam</span><span class="o">.</span><span class="n">Point3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span> <span class="c1"># angular velocity, 10 degrees per second around the Z-axis (up)</span>
</pre></div>
</div>
</div>
</div>
<p>We expect that a positive angular velocity around the <span class="math notranslate nohighlight">\(z\)</span>-axis, i.e., positive yaw, will correspond to a counter-clockwise spinning of the drone when looking from the top. Let us confirm this by implementing the kinematics in code.</p>
<p>We can integrate the linear and angular velocities <code class="docutils literal notranslate"><span class="pre">vb</span></code> and <code class="docutils literal notranslate"><span class="pre">wb</span></code> above, <em>taking care to convert the body velocity to the navigation frame at each time step</em>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#| caption: Drone kinematics simulation.</span>
<span class="c1">#| label: fig:drone_kinematics</span>
<span class="n">vn0</span> <span class="o">=</span> <span class="n">nRb0</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">vb</span><span class="p">)</span>  <span class="c1"># velocity in navigation frame</span>
<span class="n">drone</span> <span class="o">=</span> <span class="n">DroneKinematics</span><span class="p">(</span><span class="n">gtsam</span><span class="o">.</span><span class="n">Point3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">vn0</span><span class="p">,</span> <span class="n">nRb0</span><span class="p">,</span> <span class="n">wb</span><span class="p">)</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">scatter_3d</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">z</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">scale</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;F&quot;</span><span class="p">,</span> <span class="s2">&quot;L&quot;</span><span class="p">,</span> <span class="s2">&quot;U&quot;</span><span class="p">]</span>
<span class="n">fig</span><span class="o">.</span><span class="n">add_traces</span><span class="p">(</span><span class="n">axes</span><span class="p">(</span><span class="n">drone</span><span class="o">.</span><span class="n">pose</span><span class="p">(),</span> <span class="n">scale</span><span class="p">,</span> <span class="n">labels</span><span class="p">))</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">drone</span><span class="o">.</span><span class="n">vn</span> <span class="o">=</span> <span class="n">drone</span><span class="o">.</span><span class="n">nRb</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">vb</span><span class="p">)</span>  <span class="c1"># velocity in navigation frame</span>
    <span class="n">drone</span><span class="o">.</span><span class="n">integrate</span><span class="p">(</span><span class="n">dt</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_traces</span><span class="p">(</span><span class="n">axes</span><span class="p">(</span><span class="n">drone</span><span class="o">.</span><span class="n">pose</span><span class="p">(),</span> <span class="n">scale</span><span class="p">,</span> <span class="n">labels</span><span class="p">))</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">scene_aspectmode</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/9126d8aac48e0d47cf418f4d605aeff0728f5ab5698dc3b3d81a55b33828b9fd.png" src="_images/9126d8aac48e0d47cf418f4d605aeff0728f5ab5698dc3b3d81a55b33828b9fd.png" />
</div>
</div>
<p>Above we used the <code class="docutils literal notranslate"><span class="pre">gtbook.drone.axes</span></code> method, which hides more magic to create the axes.You can see that the drone takes off in the positive <span class="math notranslate nohighlight">\(x\)</span>-direction, which is East in the ENU convention, and then gradually turns towards the north, which is indeed a counter-clockwise rotation around vertical!</p>
<section id="exercises">
<h3><span class="section-number">7.2.4.1. </span>Exercises<a class="headerlink" href="#exercises" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Change the direction of the turn to the other side.</p></li>
<li><p>Change the code to use different values for <span class="math notranslate nohighlight">\(\Delta t\)</span> and observe the results.</p></li>
<li><p>Change the initial forward orientation to be the <em>northern</em> direction.</p></li>
</ul>
</section>
</section>
<section id="full-rigid-body-dynamics">
<h2><span class="section-number">7.2.5. </span>Full Rigid-Body Dynamics<a class="headerlink" href="#full-rigid-body-dynamics" title="Permalink to this heading">#</a></h2>
<blockquote>
<div><p>Not hard to write down, but harder to understand.</p>
</div></blockquote>
<p>Ultimately we need to move a quadrotor by provide forces through the four rotors.
Above we have discussed the forces that are applied by the rotors.
We now extend this idea to include <strong>torques</strong>, which are the rotational version of forces.
The combination of forces and torques yield corresponding linear and angular accelerations.</p>
<p>Let us start with Newton’s second law, with the acceleration <span class="math notranslate nohighlight">\(a\)</span> written suggestively as <span class="math notranslate nohighlight">\(\dot{v}^n\)</span>, and immediately thinking in terms of force and velocity <em>vectors</em> in the navigation frame:</p>
<div class="math notranslate nohighlight">
\[
F^n = m \dot{v}^n
\]</div>
<p>The <strong>mass</strong> <span class="math notranslate nohighlight">\(m\)</span> can be seen as a scalar that <em>resists</em> motion: the higher the mass, the higher the force needed to produce an acceleration in any direction. Note that we could consider <span class="math notranslate nohighlight">\(m\)</span> to be a diagonal matrix with the mass on the diagonal: acceleration is resisted the same way in all three axes, in whatever coordinate frame we choose.</p>
<p>The same is (approximately) true for rotational motion.
If we write the torques on the quadrotor with respect to the body frame,
if the angular velocity is given by <span class="math notranslate nohighlight">\(\omega^b\)</span>,
the corresponding body torque is approximately given by</p>
<div class="math notranslate nohighlight">
\[
\tau^b \approx I \dot{\omega}^b
\]</div>
<p>This is only an approximation, because it ignores gyroscopic forces, but it is reasonable for small angular velocities <span class="math notranslate nohighlight">\(\omega^b\)</span>.</p>
<p>Here the <strong>inertia matrix</strong> <span class="math notranslate nohighlight">\(I\)</span> is resisting <em>angular</em> motion.
Expressed in an FLU body coordinate frame, the inertia matrix <span class="math notranslate nohighlight">\(I\)</span> is typically approximated by a diagonal matrix with “small-small-big” diagonal elements, as the motor masses are further away from the <span class="math notranslate nohighlight">\(z\)</span>-axis than from the <span class="math notranslate nohighlight">\(x\)</span>- and
<span class="math notranslate nohighlight">\(y\)</span>-axes, and hence resist acceleration around the <span class="math notranslate nohighlight">\(z\)</span>-axis more.</p>
<p>Let us calculate the moments of inertia assuming that each motor is 150 grams, and neglecting the body’s mass for now. All four motors contribute to the moment of inertia <span class="math notranslate nohighlight">\(I_{xx}\)</span> around the X-axis. Each motor, at a distance of <span class="math notranslate nohighlight">\(r = 0.1\)</span> meters from the <span class="math notranslate nohighlight">\(x\)</span>-axis, contributes <span class="math notranslate nohighlight">\(m \times r^2\)</span> to the moment of inertia, which gives:</p>
<div class="math notranslate nohighlight">
\[
I_{xx} = 4 \times 0.15 \times 0.1^2 = 0.006 \, \text{kg} \cdot \text{m}^2
\]</div>
<p>Because of symmetry, <span class="math notranslate nohighlight">\(I_{yy}\)</span> has the same value. For the moment of inertia <span class="math notranslate nohighlight">\(I_{zz}\)</span> about the z-axis what counts is the distance of each motor from the z-axis, which is <span class="math notranslate nohighlight">\(\sqrt{0.1^2 + 0.1^2}\)</span> for each motor. Hence</p>
<div class="math notranslate nohighlight">
\[
I_{zz} = 4 \times 0.15 \times (0.1^2 + 0.1^2) = 0.012 \, \text{kg} \cdot \text{m}^2
\]</div>
<p>As you can see, because the motors are farther away from the <span class="math notranslate nohighlight">\(z\)</span>-axis than from the <span class="math notranslate nohighlight">\(x\)</span>- or <span class="math notranslate nohighlight">\(y\)</span>-axes, it takes twice the torque around the <span class="math notranslate nohighlight">\(z\)</span>-axis to get the same angular acceleration.</p>
<section id="gyroscopic-effects">
<h3><span class="section-number">7.2.5.1. </span>Gyroscopic effects<a class="headerlink" href="#gyroscopic-effects" title="Permalink to this heading">#</a></h3>
<blockquote>
<div><p>From the approximate to the exact.</p>
</div></blockquote>
<p>If a quadrotor undergoes large angular velocities, we cannot ignore gyroscopic effects.
In this case, the (exact) rotational dynamics equation is given by:</p>
<div class="math notranslate nohighlight">
\[
\tau^b = I \dot{\omega}^b + \omega^b \times I \omega^b,
\]</div>
<p>where <span class="math notranslate nohighlight">\(\times\)</span> is the vector cross-product. The second term is a set of quadratic components in the angular velocity <span class="math notranslate nohighlight">\(\omega^b\)</span> and that is why for small angular velocities they can be ignored. In fact, in many cases the orientation of a quadrotor is <em>actively controlled</em> to stay constant during hovering or in fast forward flight, and it is only in complicated maneuvers that large angular velocities occur.</p>
</section>
<section id="generating-force-and-torque">
<h3><span class="section-number">7.2.5.2. </span>Generating Force and Torque<a class="headerlink" href="#generating-force-and-torque" title="Permalink to this heading">#</a></h3>
<p>What is still missing is how to translate from forces at the rotors to a force and torque on the <em>body</em>. In the body coordinate frame, the force equation is easy and we have seen it before:</p>
<div class="math notranslate nohighlight">
\[
F^b_z = f \doteq \sum_i f_i.
\]</div>
<p>Above the forces <span class="math notranslate nohighlight">\(f_i\)</span> at the rotors are all oriented along the body <span class="math notranslate nohighlight">\(z\)</span>-coordinate axis (up!) and hence when we sum them we get a single force component <span class="math notranslate nohighlight">\(F^b_z\)</span> along the body <span class="math notranslate nohighlight">\(z\)</span>-axis.</p>
<p>We also need to include the effect of gravity, which acts along the negative <span class="math notranslate nohighlight">\(z\)</span>-axis of the navigation frame.
If we denote by <span class="math notranslate nohighlight">\(F_\mathrm{{tot}}\)</span> the total force, which includes both the effects of the rotor thrusts and of gravity,
we have have:</p>
<div class="math notranslate nohighlight">
\[
F_\mathrm{tot}^n = R^n_b F^b + m g^n
\]</div>
<p>where <span class="math notranslate nohighlight">\(F^b \doteq [0,0,f]^T\)</span> is the 3D thrust vector in the body frame, and <span class="math notranslate nohighlight">\(g^n \doteq [0,0,-g]^T\)</span> is the gravity vector, expressed in the navigation frame.</p>
<p>The torque <span class="math notranslate nohighlight">\(\tau^b\)</span> in the body frame is a bit more involved, and is a function of the force vector <span class="math notranslate nohighlight">\(f\)</span>. The exact formula depends on the geometry of the rotors. For example, for a 4-motor “X” configuration with motor 1 forward left and numbered clockwise, we obtain</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\tau^b = \begin{bmatrix}
l(f_{1}-f_{2}-f_{3}+f_{4})\\
l(f_{1}+f_{2}-f_{3}-f_{4})\\
\kappa (f_{1}-f_{2}+f_{3}-f_{4})\\
\end{bmatrix}
\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(l\)</span> is the distance from the rotors to the center of mass, and <span class="math notranslate nohighlight">\(\kappa\)</span> is a torque constant.
From this equation you can see that a quadrotor is like a differential drive robot but with <em>two</em> differential axes. Controlling it is easy in principle: <em>tilt, then move</em>. A part of <span class="math notranslate nohighlight">\(F^b_z\)</span> will be used to keep the quadrotor flying, the other part will be used to overcome drag and attain a constant velocity in the chosen direction.</p>
<p>The final piece of the puzzle is how exactly the rotors generate the individual forces <span class="math notranslate nohighlight">\(f_i\)</span>. We will not discuss that in detail here, but suffice to say that the forces <span class="math notranslate nohighlight">\(f_i\)</span> are well understood functions of the rotor speed. Each motor also generates a small torque <span class="math notranslate nohighlight">\(\kappa f_i\)</span> around it’s rotor axis,  proportional to the force with proportionality constant <span class="math notranslate nohighlight">\(\kappa\)</span>. The rotation direction for each rotor determines which sign to use to calculate the <span class="math notranslate nohighlight">\(z\)</span>-component of the body torque <span class="math notranslate nohighlight">\(\tau^b\)</span>.</p>
<section id="id1">
<h4><span class="section-number">7.2.5.2.1. </span>Exercises<a class="headerlink" href="#id1" title="Permalink to this heading">#</a></h4>
<ul class="simple">
<li><p>Try to deeply understand the torque matrix above.</p></li>
<li><p>Try to create the torque matrix for a 4-motor “+” configuration.</p></li>
</ul>
</section>
</section>
<section id="putting-it-all-together">
<h3><span class="section-number">7.2.5.3. </span>Putting it all together<a class="headerlink" href="#putting-it-all-together" title="Permalink to this heading">#</a></h3>
<blockquote>
<div><p>Kinematics and dynamics make motion.</p>
</div></blockquote>
<p>Kinematics governs how states are moved by velocities, and dynamics governs how accelerations are changed by forces and moments. Putting things together, the full equations of motion for the drone then read:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\dot r^n = v^n \\
\dot{R}^n_b	=  \hat{\omega}^n R^n_b \\
m \dot v ^n = R^n_b F^b + m g^n \\
I \dot{\omega}^b = \tau^b + \omega^b \times I \omega^b
\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(r^n\)</span>, <span class="math notranslate nohighlight">\(v^n\)</span>, <span class="math notranslate nohighlight">\(R^n_b\)</span>, and <span class="math notranslate nohighlight">\(\omega^n\)</span> are kinematic state, <span class="math notranslate nohighlight">\(F^b\)</span> and <span class="math notranslate nohighlight">\(\tau^b\)</span> are dynamic inputs, and <span class="math notranslate nohighlight">\(m\)</span> and <span class="math notranslate nohighlight">\(I\)</span> are system parameters.</p>
<p>With this, we can create the final version of a drone simulator, which we will use fully in Section 7.5. Note we model drag but neglect gyroscopic effects below:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Drone</span><span class="p">(</span><span class="n">DroneKinematics</span><span class="p">):</span>
    <span class="n">g</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">9.81</span>
    <span class="n">mass</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">k_d</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0425</span>                        <span class="c1"># drag coefficient</span>
    <span class="n">gn</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">gtsam</span><span class="o">.</span><span class="n">Point3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">g</span><span class="p">)</span>    <span class="c1"># gravity vector in navigation frame.</span>
    <span class="n">I_xy</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="mf">0.15</span> <span class="o">*</span> <span class="n">mass</span> <span class="o">*</span> <span class="mf">0.1</span><span class="o">**</span><span class="mi">2</span>     <span class="c1"># All 4 motors contribute to I_xy</span>
    <span class="n">I_z</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="mf">0.15</span> <span class="o">*</span> <span class="n">mass</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="mf">0.1</span><span class="o">**</span><span class="mi">2</span>  <span class="c1"># I_z leverages longer arm</span>
    <span class="n">I</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">([</span><span class="n">I_xy</span><span class="p">,</span> <span class="n">I_xy</span><span class="p">,</span> <span class="n">I_z</span><span class="p">])</span>             <span class="c1"># Inertia matrix</span>

    <span class="c1"># define integrate method that updates dynamics and then calls super&#39;s integrate method:</span>
    <span class="k">def</span> <span class="nf">integrate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">tau</span><span class="p">:</span><span class="n">gtsam</span><span class="o">.</span><span class="n">Point3</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Integrate equations of motion given dynamic inputs f and tau.&quot;&quot;&quot;</span>
        <span class="c1"># Calculate net force in navigation frame, including gravity and drag:</span>
        <span class="n">Fb</span> <span class="o">=</span> <span class="n">gtsam</span><span class="o">.</span><span class="n">Point3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
        <span class="n">drag_force</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">k_d</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">vn</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vn</span><span class="p">)</span>
        <span class="n">net_force</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nRb</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">Fb</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">gn</span> <span class="o">+</span> <span class="n">drag_force</span>
        
        <span class="c1"># Integrate velocity in navigation frame:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vn</span> <span class="o">+=</span> <span class="n">net_force</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass</span>

        <span class="c1"># rotational drag, assume 10x smaller linearly proportional to angular velocity:</span>
        <span class="n">net_tau</span> <span class="o">=</span> <span class="n">tau</span> <span class="o">-</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_d</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">wb</span>

        <span class="c1"># Integrate angular velocity in body frame:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wb</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">net_tau</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">I_xy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wb</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">net_tau</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">I_xy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wb</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="n">net_tau</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">I_z</span>
        
        <span class="c1"># Call super&#39;s integrate method for kinematics</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">integrate</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We can verify that with just enough upward thrust (<span class="math notranslate nohighlight">\(f=9.81\)</span>) and zero torque, we attain a perfect hover:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#| caption: Dynamics simulation of a drone hovering.</span>
<span class="c1">#| label: fig:drone_dynamics</span>
<span class="n">zero</span> <span class="o">=</span> <span class="k">lambda</span> <span class="p">:</span> <span class="n">gtsam</span><span class="o">.</span><span class="n">Point3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">drone</span> <span class="o">=</span> <span class="n">Drone</span><span class="p">(</span><span class="n">rn</span><span class="o">=</span><span class="n">zero</span><span class="p">(),</span> <span class="n">vn</span><span class="o">=</span><span class="n">zero</span><span class="p">(),</span> <span class="n">nRb</span><span class="o">=</span><span class="n">gtsam</span><span class="o">.</span><span class="n">Rot3</span><span class="p">(),</span> <span class="n">wb</span><span class="o">=</span><span class="n">zero</span><span class="p">())</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">scatter_3d</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">z</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">fig</span><span class="o">.</span><span class="n">add_traces</span><span class="p">(</span><span class="n">axes</span><span class="p">(</span><span class="n">drone</span><span class="o">.</span><span class="n">pose</span><span class="p">(),</span> <span class="n">scale</span><span class="p">,</span> <span class="n">labels</span><span class="p">))</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">drone</span><span class="o">.</span><span class="n">integrate</span><span class="p">(</span><span class="mf">9.81</span><span class="p">,</span> <span class="n">zero</span><span class="p">(),</span> <span class="n">dt</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_traces</span><span class="p">(</span><span class="n">axes</span><span class="p">(</span><span class="n">drone</span><span class="o">.</span><span class="n">pose</span><span class="p">(),</span> <span class="n">scale</span><span class="p">,</span> <span class="n">labels</span><span class="p">))</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">scene_aspectmode</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/cacb6d9e3d9c08e30e458c94770aab5c823658f08def2d6ae5b668b1ff8e35c6.png" src="_images/cacb6d9e3d9c08e30e458c94770aab5c823658f08def2d6ae5b668b1ff8e35c6.png" />
</div>
</div>
<p>Because we model drag, for a given non-zero linear velocity the drone keeps moving because of inertia but slows down as time goes on:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#| caption: Dynamics simulation of a drone floating forward.</span>
<span class="c1">#| label: fig:drone_dynamics_forward</span>
<span class="n">drone</span> <span class="o">=</span> <span class="n">Drone</span><span class="p">(</span><span class="n">rn</span><span class="o">=</span><span class="n">zero</span><span class="p">(),</span> <span class="n">vn</span><span class="o">=</span><span class="n">gtsam</span><span class="o">.</span><span class="n">Point3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">nRb</span><span class="o">=</span><span class="n">gtsam</span><span class="o">.</span><span class="n">Rot3</span><span class="p">(),</span> <span class="n">wb</span><span class="o">=</span><span class="n">zero</span><span class="p">())</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">scatter_3d</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">z</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">fig</span><span class="o">.</span><span class="n">add_traces</span><span class="p">(</span><span class="n">axes</span><span class="p">(</span><span class="n">drone</span><span class="o">.</span><span class="n">pose</span><span class="p">(),</span> <span class="n">scale</span><span class="p">,</span> <span class="n">labels</span><span class="p">))</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">drone</span><span class="o">.</span><span class="n">integrate</span><span class="p">(</span><span class="mf">9.81</span><span class="p">,</span> <span class="n">zero</span><span class="p">(),</span> <span class="n">dt</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_traces</span><span class="p">(</span><span class="n">axes</span><span class="p">(</span><span class="n">drone</span><span class="o">.</span><span class="n">pose</span><span class="p">(),</span> <span class="n">scale</span><span class="p">,</span> <span class="n">labels</span><span class="p">))</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">scene_aspectmode</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;final velocity:&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">drone</span><span class="o">.</span><span class="n">vn</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/a00bd09f740291fcd23b69cc7e69cc442c64fb32c4a38409af44c52c7331083c.png" src="_images/a00bd09f740291fcd23b69cc7e69cc442c64fb32c4a38409af44c52c7331083c.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>final velocity: [0.69 0.   0.  ]
</pre></div>
</div>
</div>
</div>
<p>We can also execute fully dynamic maneuvers. Here we show the forward flight condition we discussed above.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#| caption: Dynamics simulation of a drone accelerating through pitching.</span>
<span class="c1">#| label: fig:drone_dynamics_pitch</span>
<span class="n">pitch</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">f</span> <span class="o">=</span> <span class="mf">9.81</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">pitch</span><span class="p">)</span>
<span class="n">drone</span> <span class="o">=</span> <span class="n">Drone</span><span class="p">(</span><span class="n">rn</span><span class="o">=</span><span class="n">zero</span><span class="p">(),</span> <span class="n">vn</span><span class="o">=</span><span class="n">zero</span><span class="p">(),</span> <span class="n">nRb</span><span class="o">=</span><span class="n">gtsam</span><span class="o">.</span><span class="n">Rot3</span><span class="o">.</span><span class="n">Pitch</span><span class="p">(</span><span class="n">pitch</span><span class="p">),</span> <span class="n">wb</span><span class="o">=</span><span class="n">zero</span><span class="p">())</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">scatter_3d</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">z</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">scale</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;F&quot;</span><span class="p">,</span> <span class="s2">&quot;L&quot;</span><span class="p">,</span> <span class="s2">&quot;U&quot;</span><span class="p">]</span>
<span class="n">fig</span><span class="o">.</span><span class="n">add_traces</span><span class="p">(</span><span class="n">axes</span><span class="p">(</span><span class="n">drone</span><span class="o">.</span><span class="n">pose</span><span class="p">(),</span> <span class="n">scale</span><span class="p">,</span> <span class="n">labels</span><span class="p">))</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">drone</span><span class="o">.</span><span class="n">integrate</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">zero</span><span class="p">(),</span> <span class="n">dt</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_traces</span><span class="p">(</span><span class="n">axes</span><span class="p">(</span><span class="n">drone</span><span class="o">.</span><span class="n">pose</span><span class="p">(),</span> <span class="n">scale</span><span class="p">,</span> <span class="n">labels</span><span class="p">))</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">scene_aspectmode</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/eb3c3dcb1e240ebd3f71f7596b7545e319bbf701df21e0ae1a9d370f7e839d36.png" src="_images/eb3c3dcb1e240ebd3f71f7596b7545e319bbf701df21e0ae1a9d370f7e839d36.png" />
</div>
</div>
<p>Note the drone speeds up from hover but fairly quickly reaches terminal velocity because of drag.</p>
<p>Finally, if we input a small moment, we can make the drone changes direction. However, one’s first instinct of rotating around the body Up/<span class="math notranslate nohighlight">\(z\)</span>-axis will not actually make the drone’s trajectory curved! Indeed, in the body frame, rotating around the <span class="math notranslate nohighlight">\(z\)</span>-axis leaves the direction of the <span class="math notranslate nohighlight">\(z\)</span>-axis unchanged, and hence also the thrust exerted by the motors. While the “Forward” direction of the drone will change, only a change in the direction of thrust can make the center of mass move along a curve. A small moment “roll” around the Forward/<span class="math notranslate nohighlight">\(x\)</span>-axis will do the trick:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#| caption: Dynamics simulation of a drone curving left.</span>
<span class="c1">#| label: fig:drone_dynamics_left</span>
<span class="n">drone</span> <span class="o">=</span> <span class="n">Drone</span><span class="p">(</span><span class="n">rn</span><span class="o">=</span><span class="n">zero</span><span class="p">(),</span> <span class="n">vn</span><span class="o">=</span><span class="n">zero</span><span class="p">(),</span> <span class="n">nRb</span><span class="o">=</span><span class="n">gtsam</span><span class="o">.</span><span class="n">Rot3</span><span class="o">.</span><span class="n">Pitch</span><span class="p">(</span><span class="n">pitch</span><span class="p">),</span> <span class="n">wb</span><span class="o">=</span><span class="n">zero</span><span class="p">())</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">scatter_3d</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">z</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">scale</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;F&quot;</span><span class="p">,</span> <span class="s2">&quot;L&quot;</span><span class="p">,</span> <span class="s2">&quot;U&quot;</span><span class="p">]</span>
<span class="n">fig</span><span class="o">.</span><span class="n">add_traces</span><span class="p">(</span><span class="n">axes</span><span class="p">(</span><span class="n">drone</span><span class="o">.</span><span class="n">pose</span><span class="p">(),</span> <span class="n">scale</span><span class="p">,</span> <span class="n">labels</span><span class="p">))</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">drone</span><span class="o">.</span><span class="n">integrate</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">gtsam</span><span class="o">.</span><span class="n">Point3</span><span class="p">(</span><span class="o">-</span><span class="mf">0.0001</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">dt</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_traces</span><span class="p">(</span><span class="n">axes</span><span class="p">(</span><span class="n">drone</span><span class="o">.</span><span class="n">pose</span><span class="p">(),</span> <span class="n">scale</span><span class="p">,</span> <span class="n">labels</span><span class="p">))</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">scene_aspectmode</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/6aec563f0da752e9d2e490b1b6adcbe88683126b0cdd7ced70be4cb949b2e592.png" src="_images/6aec563f0da752e9d2e490b1b6adcbe88683126b0cdd7ced70be4cb949b2e592.png" />
</div>
</div>
</section>
<section id="id2">
<h3><span class="section-number">7.2.5.4. </span>Exercises:<a class="headerlink" href="#id2" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>In this last scenario, is the drone curving the correct way? Think about the sign of the roll moment.</p></li>
<li><p>What happens if you extend the simulation? Form a hypothesis first, then try it. Does the drone keep turning? Explain.</p></li>
</ul>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="S71_drone_state.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">7.1. </span>Moving in Three Dimensions</p>
      </div>
    </a>
    <a class="right-next"
       href="S73_drone_sensing.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">7.3. </span>Sensing for Drones</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#drone-dynamics">7.2.1. Drone Dynamics</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#hover">7.2.1.1. Hover</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#forward-flight">7.2.1.2. Forward Flight</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#maximum-tilt-and-thrust">7.2.1.3. Maximum Tilt and Thrust</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#drag-and-maximum-velocity">7.2.1.4. Drag and Maximum Velocity</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#drone-kinematics">7.2.2. Drone Kinematics</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#positional-kinematics">7.2.2.1. Positional Kinematics</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#angular-velocity">7.2.2.2. Angular Velocity</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise">7.2.2.2.1. Exercise</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#rotational-kinematics">7.2.2.3. Rotational Kinematics</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#simulation-aka-forward-integrating">7.2.3. Simulation aka Forward Integrating</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#integrating-position">7.2.3.1. Integrating Position</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#integrating-attitude">7.2.3.2. Integrating Attitude</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#an-example-in-code">7.2.4. An Example in Code</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercises">7.2.4.1. Exercises</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#full-rigid-body-dynamics">7.2.5. Full Rigid-Body Dynamics</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#gyroscopic-effects">7.2.5.1. Gyroscopic effects</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#generating-force-and-torque">7.2.5.2. Generating Force and Torque</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">7.2.5.2.1. Exercises</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#putting-it-all-together">7.2.5.3. Putting it all together</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">7.2.5.4. Exercises:</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Frank Dellaert and Seth Hutchinson
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>