
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>7.2. Multi-rotor Aircraft &#8212; Introduction to Robotics and Perception</title>
    
  <link href="_static/css/theme.css" rel="stylesheet">
  <link href="_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/style.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.1/dist/embed-amd.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script>
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="7.3. Sensing for Drones" href="S73_drone_sensing.html" />
    <link rel="prev" title="7.1. Moving in Three Dimensions" href="S71_drone_state.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
<script async="" src="https://www.google-analytics.com/analytics.js"></script>
<script>
                        window.ga = window.ga || function () {
                            (ga.q = ga.q || []).push(arguments) };
                        ga.l = +new Date;
                        ga('create', 'UA-312077-7', 'auto');
                        ga('set', 'anonymizeIp', true);
                        ga('send', 'pageview');
                    </script>

  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Introduction to Robotics and Perception</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="intro.html">
   Introduction to Robotics and Perception
  </a>
 </li>
</ul>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="S10_introduction.html">
   1. Introduction
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="S11_intro_state.html">
     1.1. Representing State
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="S12_intro_actions.html">
     1.2. Robot Actions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="S13_intro_sensing.html">
     1.3. Sensing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="S14_intro_perception.html">
     1.4. Perception
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="S15_intro_decision.html">
     1.5. Planning
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="S16_intro_learning.html">
     1.6. Learning
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="S20_sorter_intro.html">
   2. A Trash Sorting Robot
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="S21_sorter_state.html">
     2.1. Modeling the World State
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="S22_sorter_actions.html">
     2.2. Actions for Sorting Trash
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="S23_sorter_sensing.html">
     2.3. Sensors for Sorting Trash
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="S24_sorter_perception.html">
     2.4. Perception
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="S25_sorter_decision_theory.html">
     2.5. Decision Theory
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="S26_sorter_learning.html">
     2.6. Learning
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="S30_vacuum_intro.html">
   3. A Robot Vacuum Cleaner
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="S31_vacuum_state.html">
     3.1. Modeling the State of the Vacuum Cleaning Robot
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="S32_vacuum_actions.html">
     3.2. Actions over time
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="S33_vacuum_sensing.html">
     3.3. Dynamic Bayes Nets
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="S34_vacuum_perception.html">
     3.4. Perception with Graphical Models
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="S35_vacuum_decision.html">
     3.5. Markov Decision Processes
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="S36_vacuum_RL.html">
     3.6. Reinforcement Learning
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="S40_logistics_intro.html">
   4. Warehouse Robots in 2D
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="S41_logistics_state.html">
     4.1. Continuous State
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="S42_logistics_actions.html">
     4.2. Moving in 2D
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="S43_logistics_sensing.html">
     4.3. Sensor Models with Continuous State
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="S44_logistics_perception.html">
     4.4. Localization
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="S45_logistics_planning.html">
     4.5. Planning for Logistics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="S46_logistics_learning.html">
     4.6. Some System Identification
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="S50_diffdrive_intro.html">
   5. A Mobile Robot With Simple Kinematics
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="S51_diffdrive_state.html">
     5.1. State Space for a Differential Drive Robot
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="S52_diffdrive_actions.html">
     5.2. Motion Model for the Differential Drive Robot
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="S53_diffdrive_sensing.html">
     5.3. Robot Vision
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="S54_diffdrive_perception.html">
     5.4. Computer Vision 101
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="S55_diffdrive_planning.html">
     5.5. Path Planning
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="S56_diffdrive_learning.html">
     5.6. Deep Learning
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="S60_driving_intro.html">
   6. Autonomous Vehicles
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="S61_driving_state.html">
     6.1. Planar Geometry
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="S62_driving_actions.html">
     6.2. Kinematics for Driving
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="S63_driving_sensing.html">
     6.3. Sensing for Autonomous Vehicles
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="S64_driving_perception.html">
     6.4. SLAM
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="S65_driving_planning.html">
     6.5. Planning for Autonomous Driving.
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="S66_driving_DRL.html">
     6.6. Deep Reinforcement Learning
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="S70_drone_intro.html">
   7. Autonomous Drones in 3D
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="S71_drone_state.html">
     7.1. Moving in Three Dimensions
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     7.2. Multi-rotor Aircraft
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="S73_drone_sensing.html">
     7.3. Sensing for Drones
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/S72_drone_actions.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/gtbook/robotics"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/gtbook/robotics/issues/new?title=Issue%20on%20page%20%2FS72_drone_actions.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/gtbook/robotics/main?urlpath=tree/S72_drone_actions.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#drone-dynamics">
   7.2.1. Drone Dynamics
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#hover">
   7.2.2. Hover
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#forward-flight">
   7.2.3. Forward Flight
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#maximum-tilt-and-thrust">
   7.2.4. Maximum Tilt and Thrust
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#drag-and-maximum-velocity">
   7.2.5. Drag and Maximum Velocity
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#full-rigid-body-kinematics">
   7.2.6. Full Rigid-Body Kinematics
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#simulation-aka-forward-integrating">
   7.2.7. Simulation aka Forward Integrating
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#integrating-position">
     7.2.7.1. Integrating Position
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#integrating-attitude">
     7.2.7.2. Integrating Attitude
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#an-example-in-code">
   7.2.8. An Example in Code
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#full-rigid-body-dynamics">
   7.2.9. Full Rigid-Body Dynamics*
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#gyroscopic-effects">
   7.2.10. Gyroscopic effects*
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Multi-rotor Aircraft</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#drone-dynamics">
   7.2.1. Drone Dynamics
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#hover">
   7.2.2. Hover
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#forward-flight">
   7.2.3. Forward Flight
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#maximum-tilt-and-thrust">
   7.2.4. Maximum Tilt and Thrust
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#drag-and-maximum-velocity">
   7.2.5. Drag and Maximum Velocity
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#full-rigid-body-kinematics">
   7.2.6. Full Rigid-Body Kinematics
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#simulation-aka-forward-integrating">
   7.2.7. Simulation aka Forward Integrating
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#integrating-position">
     7.2.7.1. Integrating Position
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#integrating-attitude">
     7.2.7.2. Integrating Attitude
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#an-example-in-code">
   7.2.8. An Example in Code
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#full-rigid-body-dynamics">
   7.2.9. Full Rigid-Body Dynamics*
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#gyroscopic-effects">
   7.2.10. Gyroscopic effects*
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <p><a href="https://colab.research.google.com/github/gtbook/robotics/blob/main/S72_drone_actions.ipynb" target="_parent"><img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab"/></a></p>
<div class="tex2jax_ignore mathjax_ignore section" id="multi-rotor-aircraft">
<h1><span class="section-number">7.2. </span>Multi-rotor Aircraft<a class="headerlink" href="#multi-rotor-aircraft" title="Permalink to this headline">¶</a></h1>
<blockquote>
<div><p>An amazing way to fly in 3D.</p>
</div></blockquote>
<p><strong>This Section is still in draft mode and was released for adventurous spirits (and TAs) only.</strong></p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output text_html">
<div align='center'>
<img src='https://github.com/gtbook/robotics/blob/main/Art/steampunk/S72-Autonomous%20camera%20drone-03.jpg?raw=1' style='height:256 width:100%'/>
</div>
</div></div>
</div>
<p>The kinematics of quadrotors and multicopters are those of simple rigid 3D bodies. Many different coordinate frame conventions are used in the literature. I introduce one good choice below, and convert equations from the literature to this convention where needed.</p>
<p>The kinematics equations are most useful for navigation and control when expressed in the navigation frame <span class="math notranslate nohighlight">\(\mathcal{N}\)</span>, which for MAV applications is almost universally assumed to be non-rotating and aligned with gravity, but can otherwise be defined arbitrarily, e.g., <strong>East-North-Up (ENU)</strong>. The origin of the navigation frame is often chosen as the take-off point, but does not have to be.</p>
<p>We also define a body frame <span class="math notranslate nohighlight">\(\mathcal{B}\)</span> as having its origin at the center of mass of the vehicle. Following convention in aerospace applications, we fix the x-axis as pointing to the front of the vehicle (not always the direction of travel), the y-axis as pointing to the left, and the z-axis pointing up, the so-called <strong>FLU convention</strong>.</p>
<p>We then define, respectively,</p>
<p>• the vehicle’s position <span class="math notranslate nohighlight">\(r^{n}\doteq[x,y,z]^{T}\)</span>,</p>
<p>• its linear velocity <span class="math notranslate nohighlight">\(v^n=\dot{r^{n}}\doteq[u,v,w]^{T}\)</span>,</p>
<p>• the attitude <span class="math notranslate nohighlight">\(R^n_b\doteq[i^b,j^b,k^b]\in SO(3)\)</span>, a <span class="math notranslate nohighlight">\(3\times 3\)</span> rotation matrix from <span class="math notranslate nohighlight">\(\mathcal{B}\)</span> to <span class="math notranslate nohighlight">\(\mathcal{N}\)</span>,</p>
<p>• the body angular velocity <span class="math notranslate nohighlight">\(\omega^b\doteq[p,q,r]^{T}\)</span>.</p>
<p>Above the superscript <span class="math notranslate nohighlight">\(n\)</span> and <span class="math notranslate nohighlight">\(b\)</span> denote quantities expressed in the <em>navigation</em> and <em>body</em> frame, respectively.</p>
<div class="section" id="drone-dynamics">
<h2><span class="section-number">7.2.1. </span>Drone Dynamics<a class="headerlink" href="#drone-dynamics" title="Permalink to this headline">¶</a></h2>
<p>Let us take the <a class="reference external" href="https://www.skydio.com/skydio-2-plus">Skydio 2+</a> as a prototypical and relevant example. Its mass, with battery, is <span class="math notranslate nohighlight">\(800g\)</span>, but let’s just say <span class="math notranslate nohighlight">\(1kg\)</span> to make the calculations easier. Its dimensions are <span class="math notranslate nohighlight">\(229mm \times 274mm\)</span>, but let’s assume the motors are at <span class="math notranslate nohighlight">\((+/- 0.10m, +/- 0.10m)\)</span>, which is not too far off.</p>
</div>
<div class="section" id="hover">
<h2><span class="section-number">7.2.2. </span>Hover<a class="headerlink" href="#hover" title="Permalink to this headline">¶</a></h2>
<p>To hover, assuming <span class="math notranslate nohighlight">\(g=10m/s^2\)</span>, the four rotors have to provide a thrust of 10N upwards to compensate for gravity, i.e., 2.5N per motor. Of course, we need to be able to accelerate upwards, so let’s assume each motor can provide up to double that, i.e., 0 to 5N. So, while the drone is level, here are some sample accelerations we can deliver:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(f_i=0N\)</span> for <span class="math notranslate nohighlight">\(i\in{1..4}\)</span>: downwards acceleration at <span class="math notranslate nohighlight">\(-10\frac{m}{s^2}\)</span>.</p></li>
<li><p><span class="math notranslate nohighlight">\(f_i=2.5N\)</span> for <span class="math notranslate nohighlight">\(i\in{1..4}\)</span>: stable hover <span class="math notranslate nohighlight">\(0\frac{m}{s^2}\)</span>.</p></li>
<li><p><span class="math notranslate nohighlight">\(f_i=5N\)</span> for <span class="math notranslate nohighlight">\(i\in{1..4}\)</span>: upwards acceleration at <span class="math notranslate nohighlight">\(10\frac{m}{s^2}\)</span>.</p></li>
</ul>
<p>In general, the force <span class="math notranslate nohighlight">\(F^b_z\)</span> aligned with the body Z-axis will be</p>
<div class="math notranslate nohighlight">
\[
F^b_z = \sum_{i=1}^4 f_i
\]</div>
</div>
<div class="section" id="forward-flight">
<h2><span class="section-number">7.2.3. </span>Forward Flight<a class="headerlink" href="#forward-flight" title="Permalink to this headline">¶</a></h2>
<p>Of course, when we <em>tilt</em> the quadrotor forwards, we will direct some of that thrust towards generating horizontal acceleration. To get a handle on this, we need to calculate the thrust in the <em>navigation</em> frame, but this is just a matter of multiplying with the rotation matrix <span class="math notranslate nohighlight">\(R^n_b\)</span>:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
F^n = R^n_b \begin{bmatrix}0 \\ 0 \\ F^b_z\end{bmatrix} = \hat{z}^n_b F^b_z
\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(\hat{z}^n_b\)</span> is the third column of <span class="math notranslate nohighlight">\(R^n_b\)</span>, i.e., this is simply the Z-axis <span class="math notranslate nohighlight">\(\hat{z}\)</span> of the body frame, expressed in the navigation frame. <em>In other words, the thrust in the navigation frame is always aligned with the body’s Z-axis, and hence by rotating the quadrotor appropriately we can achieve any thrust direction we desire</em>.</p>
<p>Let us assume that the FLU body frame is currently oriented along the Y-axis of the ENU navigation frame, i.e., we are flying NORTH, then if we tilt forward with an angle of <span class="math notranslate nohighlight">\(\theta\)</span> with respect to vertical, we obtain</p>
<div class="math notranslate nohighlight">
\[\begin{split}
F^n = \begin{bmatrix}0 \\ \sin \theta \\ \cos \theta\end{bmatrix} F^b_z
\end{split}\]</div>
<p>and hence if we want to maintain level flight, we need to keep compensating for gravity by maintaining</p>
<div class="math notranslate nohighlight">
\[
\cos \theta F^b_z = 10N.
\]</div>
<p>That in turn means that the forward trust (along the navigation Y-axis) will be</p>
<div class="math notranslate nohighlight">
\[
F^n_y = \sin \theta F^b_z = \sin \theta \frac{10N}{\cos \theta} = \tan \theta \cdot 10N 
\]</div>
</div>
<div class="section" id="maximum-tilt-and-thrust">
<h2><span class="section-number">7.2.4. </span>Maximum Tilt and Thrust<a class="headerlink" href="#maximum-tilt-and-thrust" title="Permalink to this headline">¶</a></h2>
<p>We are also constrained, however, by the maximum thrust <span class="math notranslate nohighlight">\(F^b_z\)</span> we can deliver, which is 20N. Hence,</p>
<div class="math notranslate nohighlight">
\[
F^b_z = \frac{10N}{\cos \theta} \leq 20N \rightarrow \cos \theta \geq 0.5 \rightarrow -60^\circ \leq \theta \leq 60^\circ,
\]</div>
<p>the maximum tilt angle is 60 degrees. At that maximum tilt angle, we have</p>
<div class="math notranslate nohighlight">
\[
F^n_y = \tan \theta_{\max} \cdot 10N \approx 17N 
\]</div>
<p>So, we are limited to <span class="math notranslate nohighlight">\(17N\)</span> of forward thrust, and this when tilting very aggressively at 60 degrees. If we tilt more, we can improve thrust even more (up to 20N) but the drone will start falling out of the sky.</p>
</div>
<div class="section" id="drag-and-maximum-velocity">
<h2><span class="section-number">7.2.5. </span>Drag and Maximum Velocity<a class="headerlink" href="#drag-and-maximum-velocity" title="Permalink to this headline">¶</a></h2>
<p>Importantly, constant forward thrust does <em>not</em> mean that the drone will continue accelerating, because of <em>drag</em>. In fact, from the spec-sheet of the Skydio-2 we see that the top speed (in autonomous mode) is 36Mph, which is about <span class="math notranslate nohighlight">\(16m/s\)</span>, and the theoretical top speed is probably more like <span class="math notranslate nohighlight">\(20m/s\)</span>. Since drag increases <em>quadratically</em> with velocity, we can calculate the corresponding drag coefficient as the drag force has to exactly balance the maximum forward thrust at the top speed:</p>
<div class="math notranslate nohighlight">
\[
17N = k_d v_{top}^2 = k_d 20^2 m^2/s^2 \rightarrow k_d = 0.0425
\]</div>
<p>Now that we have the drag coefficient <span class="math notranslate nohighlight">\(k_d\)</span>, we can calculate a simple mapping from tilt angle <span class="math notranslate nohighlight">\(\theta\)</span> to forward velocity. Indeed, given tilt <span class="math notranslate nohighlight">\(\theta\)</span>, can calculate the forward thrust <span class="math notranslate nohighlight">\(F^n_y\)</span> in the navigation frame, and the velocity can be obtained by equating that to the drag force <span class="math notranslate nohighlight">\(k^d v^2\)</span>:</p>
<div class="math notranslate nohighlight">
\[
F^n_y = \tan \theta \cdot 10N = k_d v^2 \rightarrow v = \sqrt{\frac{\tan \theta \cdot 10}{k_d}} = \sqrt{\frac{10}{k_d}} \sqrt{\tan \theta} \approx 15 \sqrt{\tan \theta}
\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">vmap</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">theta</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">40</span><span class="p">,</span><span class="mi">50</span><span class="p">]:</span>
  <span class="n">vmap</span><span class="p">[</span><span class="n">theta</span><span class="p">]</span> <span class="o">=</span> <span class="mi">15</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">theta</span><span class="p">)))</span>
  <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;v(</span><span class="si">{</span><span class="n">theta</span><span class="si">}</span><span class="s2">) ~ </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">vmap</span><span class="p">[</span><span class="n">theta</span><span class="p">])</span><span class="si">}</span><span class="s2"> m/s&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>v(0) ~ 0 m/s
v(1) ~ 2 m/s
v(5) ~ 4 m/s
v(10) ~ 6 m/s
v(15) ~ 8 m/s
v(20) ~ 9 m/s
v(30) ~ 11 m/s
v(40) ~ 14 m/s
v(50) ~ 16 m/s
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">px</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">vmap</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="n">y</span><span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">vmap</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/S72_drone_actions_12_0.png" src="_images/S72_drone_actions_12_0.png" />
</div>
</div>
</div>
<div class="section" id="full-rigid-body-kinematics">
<h2><span class="section-number">7.2.6. </span>Full Rigid-Body Kinematics<a class="headerlink" href="#full-rigid-body-kinematics" title="Permalink to this headline">¶</a></h2>
<p>Below I develop all attitude kinematics and dynamics directly on <span class="math notranslate nohighlight">\(SO(3)\)</span>, following Murray et al. (1994).
In particular, the vehicle’s kinematics are given by</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align}
\dot{r}^{n}	&amp;= v^n \\
\dot{R}^n_b	&amp;= R^n_b\hat{\omega}^b
\end{align}
\end{split}\]</div>
<p>where the <span class="math notranslate nohighlight">\(3\times 3\)</span> skew-symmetric matrix <span class="math notranslate nohighlight">\(\hat{\omega}^b\doteq (R^n_b)^{T}\dot{R}^n_b\)</span> is obtained from the 3-vector <span class="math notranslate nohighlight">\(\omega^b\)</span> as follows:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\hat{\omega}^b\doteq\begin{bmatrix}
 &amp; -\omega^b_{z} &amp; \omega^b_{y}\\
\omega^b_{z} &amp;  &amp; -\omega^b_{x}\\
-\omega^b_{y} &amp; \omega^b_{x}
\end{bmatrix}.
\end{split}\]</div>
<p>Note <span class="math notranslate nohighlight">\(\hat{\omega}^b\in so(3)\)</span>, the Lie algebra associated with the 3D rotation group <span class="math notranslate nohighlight">\(SO(3)\)</span>.
Also, the kinematics can also expressed using the spatial angular velocity <span class="math notranslate nohighlight">\(\omega^n\doteq R^n_b\omega^b\)</span>, i.e.,</p>
<div class="math notranslate nohighlight">
\[
\dot{R}^n_b	= \hat{\omega}^n R^n_b
\]</div>
<p>However, it is much easier to visualize and calculate the angular velocity in the body frame.</p>
</div>
<div class="section" id="simulation-aka-forward-integrating">
<h2><span class="section-number">7.2.7. </span>Simulation aka Forward Integrating<a class="headerlink" href="#simulation-aka-forward-integrating" title="Permalink to this headline">¶</a></h2>
<p>If time histories <span class="math notranslate nohighlight">\(v^n(t)\)</span> and <span class="math notranslate nohighlight">\(\omega^b(t)\)</span> for the linear and angular velocities are available, the vehicle’s position <span class="math notranslate nohighlight">\(r^{n}(t)\)</span> and attitude <span class="math notranslate nohighlight">\(R^n_b(t)\)</span> can be integrated forward using the following two equations:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align}
r^n_{k+1} &amp;= r^n_{k} + d^k_{k+1}[v^n(t), \Delta t]\\
R^n_{b,k+1} &amp;= R^n_{b,k} R^k_{k+1}[\omega^b(t), \Delta t]
\end{align}
\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(\Delta t\)</span> is the sample time and</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(d^k_{k+1}[v^n(t), \Delta t]\)</span> is the relative displacement obtained by exactly integrating the velocity <span class="math notranslate nohighlight">\(v^n(t)\)</span> over the interval <span class="math notranslate nohighlight">\((t_k,t_{k+1}]\)</span>, and</p></li>
<li><p><span class="math notranslate nohighlight">\(R^k_{k+1}[\omega^b(t), \Delta t]\)</span> is the relative rotation obtained by exactly integrating the angular velocity <span class="math notranslate nohighlight">\(\omega^b(t)\)</span> over that same interval.</p></li>
</ul>
<div class="section" id="integrating-position">
<h3><span class="section-number">7.2.7.1. </span>Integrating Position<a class="headerlink" href="#integrating-position" title="Permalink to this headline">¶</a></h3>
<p>The above is exact, but when implementing this in code we need to use a numerical integration scheme. For position, the simplest integration scheme is the <strong>forward Euler method</strong></p>
<div class="math notranslate nohighlight">
\[
d^k_{k+1}[v^n(t), \Delta t] \approx v^n(t_k) \Delta t
\]</div>
<p>which approximates velocity <span class="math notranslate nohighlight">\(v^n(t)\)</span> over the interval <span class="math notranslate nohighlight">\((t_k,t_{k+1}]\)</span> as constant with value <span class="math notranslate nohighlight">\(v^n(t_k)\)</span>. There is also the <strong>backward Euler method</strong>, which uses <span class="math notranslate nohighlight">\(v^n(t_{k+1})\)</span>, and the <strong>trapezoidal method</strong>, which uses the average <span class="math notranslate nohighlight">\(0.5v^n(t_k)+0.5v^n(t_{k+1})\)</span>. More sophisticated integration schemes are possible, allowing for larger sample times <span class="math notranslate nohighlight">\(\Delta t\)</span>, but they require more function evaluations of the velocity.</p>
</div>
<div class="section" id="integrating-attitude">
<h3><span class="section-number">7.2.7.2. </span>Integrating Attitude<a class="headerlink" href="#integrating-attitude" title="Permalink to this headline">¶</a></h3>
<p>For the attitude part, it turns out that the Euler method can be implemented <em>in closed form</em> using <strong>Rodrigues’ rotation formula</strong>:</p>
<div class="math notranslate nohighlight">
\[
R^k_{k+1}[\omega^b(t), \Delta t] \approx I + \sin\theta K + (1-\cos\theta) K^2
\]</div>
<p>where <span class="math notranslate nohighlight">\(\theta=\|\omega^b_k\| \Delta t\)</span> is the amount of rotation over the <span class="math notranslate nohighlight">\(\Delta t\)</span> interval, and the <span class="math notranslate nohighlight">\(3\times 3\)</span> matrix <span class="math notranslate nohighlight">\(K=\hat{\omega}^b_k/\|\omega^b_k\|\)</span> is the screw symmetric matrix <span class="math notranslate nohighlight">\(\hat{\omega}^b_k\)</span> normalized by <span class="math notranslate nohighlight">\(\|\omega^b_k\|\)</span>. The approximation sign above is because this is <em>still</em> an Euler step, only exact if the time-varying angular velocity <span class="math notranslate nohighlight">\(\omega^b(t)\)</span> is actually constant over the interval.
This formula is also sometimes written in terms of an exponentiation,</p>
<div class="math notranslate nohighlight">
\[
\exp \{ \hat{\omega}^b_k \Delta t \} = I + \sin\theta K + (1-\cos\theta) K^2
\]</div>
<p>because Rodrigues’ formula is also the expression of the <em>exponential map</em> in <span class="math notranslate nohighlight">\(SO(3)\)</span>, a concept that generalizes to other Lie groups and which we will encounter again later in this chapter.</p>
<p>The last term in Rodrigues’ formula is typically small for small sample times <span class="math notranslate nohighlight">\(\Delta t\)</span> because (a) <span class="math notranslate nohighlight">\((1-\cos\theta)\)</span> is small for small <span class="math notranslate nohighlight">\(\theta\)</span>, and (b) the matrix <span class="math notranslate nohighlight">\(K^2\)</span> contains squares of numbers smaller than 1. Hence, an often used first-order approximation for Euler’s method in rotation spaces is</p>
<div class="math notranslate nohighlight">
\[\begin{split}
R^k_{k+1}[\omega^b(t), \Delta t] \approx I + \sin\theta K \approx I + \hat{\omega}^b_k \Delta t =
\begin{bmatrix}
1 &amp; -\omega^b_{z}\Delta t  &amp; \omega^b_{y}\Delta t \\
\omega^b_{z}\Delta t  &amp; 1 &amp; -\omega^b_{x}\Delta t \\
-\omega^b_{y}\Delta t  &amp; \omega^b_{x}\Delta t  &amp; 1
\end{bmatrix}
\end{split}\]</div>
<p>where we also used the small angle approximation <span class="math notranslate nohighlight">\(\sin \theta \approx \theta\)</span>.
Note that strictly speaking this approximation (unlike Rodrigues` formula) departs the rotation manifold and we need to periodically re-normalize to ensure that <span class="math notranslate nohighlight">\(R^n_b\in SO(3)\)</span>.</p>
</div>
</div>
<div class="section" id="an-example-in-code">
<h2><span class="section-number">7.2.8. </span>An Example in Code<a class="headerlink" href="#an-example-in-code" title="Permalink to this headline">¶</a></h2>
<p>We demonstrate the above by forward integrating a quadrotor’s position and orientation starting from a “forward flight” configuration at the origin, i.e., pitched forward by 10 degrees. We first specify the attitude using <code class="docutils literal notranslate"><span class="pre">Rot3.Pitch</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nRb0</span> <span class="o">=</span> <span class="n">gtsam</span><span class="o">.</span><span class="n">Rot3</span><span class="o">.</span><span class="n">Pitch</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">nRb0</span><span class="o">.</span><span class="n">matrix</span><span class="p">(),</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[[ 0.98  0.    0.17]
 [ 0.    1.    0.  ]
 [-0.17  0.    0.98]]
</pre></div>
</div>
</div>
</div>
<p>Note that the forward X-axis (first column) is pointed slightly down, the Y-axis is level, and the Z-axis is pointed up but slightly forward. We have calculated before that the velocity at this angle is <span class="math notranslate nohighlight">\(6~m/s\)</span>, and let us also assume that the 4 rotors conspire to create a small angular velocity around the vertical body axis:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">vb</span> <span class="o">=</span> <span class="n">gtsam</span><span class="o">.</span><span class="n">Point3</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="n">wb</span> <span class="o">=</span> <span class="n">gtsam</span><span class="o">.</span><span class="n">Point3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span> <span class="c1"># 10 degrees per second</span>
</pre></div>
</div>
</div>
</div>
<p>We can now integrate these, taking care to convert the body velocity to the navigation frame at each time step:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">delta_t</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># in seconds</span>
<span class="n">K</span> <span class="o">=</span> <span class="mi">10</span> <span class="c1"># number of intervals to integrate</span>

<span class="c1"># allocate storage for time series and initialize for k=0</span>
<span class="n">rn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="n">K</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="nb">float</span><span class="p">)</span>
<span class="n">rn</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">gtsam</span><span class="o">.</span><span class="n">Point3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="n">nRb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">K</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="nb">float</span><span class="p">)</span>
<span class="n">nRb</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">nRb0</span><span class="o">.</span><span class="n">matrix</span><span class="p">()</span>

<span class="c1"># integrate forward</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">K</span><span class="p">):</span>
    <span class="n">vn</span> <span class="o">=</span> <span class="n">nRb</span><span class="p">[:,:,</span><span class="n">k</span><span class="p">]</span> <span class="o">@</span> <span class="n">vb</span>
    <span class="n">vn</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># we assume gravity is compensated for</span>
    <span class="n">rn</span><span class="p">[:,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">rn</span><span class="p">[:,</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">vn</span> <span class="o">*</span> <span class="n">delta_t</span>
    <span class="n">delta_R</span> <span class="o">=</span> <span class="n">gtsam</span><span class="o">.</span><span class="n">Rot3</span><span class="o">.</span><span class="n">Expmap</span><span class="p">(</span><span class="n">wb</span> <span class="o">*</span> <span class="n">delta_t</span><span class="p">)</span>
    <span class="n">nRb</span><span class="p">[:,:,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">nRb</span><span class="p">[:,:,</span><span class="n">k</span><span class="p">]</span> <span class="o">@</span> <span class="n">delta_R</span><span class="o">.</span><span class="n">matrix</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>The plotting code is almost as verbose, and this is using the <code class="docutils literal notranslate"><span class="pre">gtbook.drone.axes</span></code> method, which hides more magic to create the axes:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">line_3d</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">rn</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">rn</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">z</span><span class="o">=</span><span class="n">rn</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="n">scale</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;F&quot;</span><span class="p">,</span> <span class="s2">&quot;L&quot;</span><span class="p">,</span> <span class="s2">&quot;U&quot;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">K</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">nTb</span> <span class="o">=</span> <span class="n">gtsam</span><span class="o">.</span><span class="n">Pose3</span><span class="p">(</span><span class="n">gtsam</span><span class="o">.</span><span class="n">Rot3</span><span class="p">(</span><span class="n">nRb</span><span class="p">[:,:,</span><span class="n">k</span><span class="p">]),</span> <span class="n">rn</span><span class="p">[:,</span><span class="n">k</span><span class="p">]);</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_traces</span><span class="p">(</span><span class="n">axes</span><span class="p">(</span><span class="n">nTb</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">labels</span><span class="p">))</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">margin</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">l</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">scene_aspectmode</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/S72_drone_actions_24_0.png" src="_images/S72_drone_actions_24_0.png" />
</div>
</div>
<p>You can see that the drone takes off in the positive X-direction, which is East in the ENU convention, and then gradually turns towards the North.</p>
<p><strong>Exercises</strong></p>
<ul class="simple">
<li><p>Change the initial forward orientation to be the <em>northern</em> direction.</p></li>
<li><p>Change the direction of the turn to the other side.</p></li>
<li><p>Change the code to use different values for <span class="math notranslate nohighlight">\(\Delta t\)</span> and observe the results.</p></li>
</ul>
</div>
<div class="section" id="full-rigid-body-dynamics">
<h2><span class="section-number">7.2.9. </span>Full Rigid-Body Dynamics*<a class="headerlink" href="#full-rigid-body-dynamics" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>Not hard to write down, but harder to understand.</p>
</div></blockquote>
<p>Ultimately we need to move a quadrotor to provide forces by the four rotors, which will produce a force and a moment on the quadrotor body. These in turn will generate linear and angular accelerations, through the quadrotor <strong>dynamics</strong>.</p>
<p>To start, everyone knows the famous Newton’s law:</p>
<div class="math notranslate nohighlight">
\[
F^n = m \dot{v}^n
\]</div>
<p>where the <strong>mass</strong> m is a scalar <em>resisting</em> motion: the higher the mass, the higher the force needed to produce an acceleration in any dimension. Note that we could consider <span class="math notranslate nohighlight">\(m\)</span> to be a diagonal matrix with the mass on the diagonal: acceleration is resisted the same way in all three axes, in whatever coordinate frame we choose.</p>
<p>The same is (approximately) true for rotational motion</p>
<div class="math notranslate nohighlight">
\[
\tau^b \approx I \dot{\omega}^b
\]</div>
<p>where the approximation is good for small angular velocities <span class="math notranslate nohighlight">\(\omega^b\)</span>.
The inertial matrix <span class="math notranslate nohighlight">\(I\)</span> is typically a diagonal matrix with “small-small-big” diagonal elements in the FLU body coordinate frame, as the motor masses are further away from the Z-axis than from the X and Y axes, and hence resist acceleration around the Z-axis more.</p>
<p>One last step is still missing, which is how to translate from forces at the rotors to a force and moment on the <em>body</em>. In the body coordinate frame, the force equation is easy:</p>
<div class="math notranslate nohighlight">
\[
F^b_z = \sum_i f_i.
\]</div>
<p>Above the forces <span class="math notranslate nohighlight">\(f_i\)</span> at the rotors are all oriented along the body Z-coordinate axis (up!) and hence when we sum them we get a single force component <span class="math notranslate nohighlight">\(F^b_z\)</span> along the body Z-axis.</p>
<p>The torque <span class="math notranslate nohighlight">\(\tau^b\)</span> in the body frame is a bit more involved, and is a function of the force vector <span class="math notranslate nohighlight">\(f\)</span>. The exact formula depends on the geometry of the rotors. For example, for a 4-motor “X” configuration with motor 1 forward left and numbered clockwise, we obtain</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\tau^b = \begin{bmatrix}
l(f_{1}-f_{2}-f_{3}+f_{4})\\
l(f_{1}+f_{2}-f_{3}-f_{4})\\
\kappa (f_{1}-f_{2}+f_{3}-f_{4})\\
\end{bmatrix}
\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(l\)</span> is the distance from the rotors to the center of mass, and <span class="math notranslate nohighlight">\(\kappa\)</span> is a torque constant.
From this equation you can see that a quadrotor is like a differential drive robot but with <em>two</em> differential axes. Controlling it is easy in principle: <em>tilt, then move</em>. A part of <span class="math notranslate nohighlight">\(F^b_z\)</span> will be used to keep the quadrotor flying, the other part will be used to overcome drag.</p>
<p>The final piece of the puzzle is how the rotors generate the individual forces <span class="math notranslate nohighlight">\(f_i\)</span>. We will not discuss that in detail here, but suffice to say that they are well understood functions of the rotor speed. Each motor also generates a small moment <span class="math notranslate nohighlight">\(\kappa f_i\)</span> around it’s rotor axis,  proportional to the force with proportionality constant <span class="math notranslate nohighlight">\(\kappa\)</span>. The rotation direction for each rotor determines which sign to use to calculate the Z-component of the body torque <span class="math notranslate nohighlight">\(\tau^b\)</span>.</p>
</div>
<div class="section" id="gyroscopic-effects">
<h2><span class="section-number">7.2.10. </span>Gyroscopic effects*<a class="headerlink" href="#gyroscopic-effects" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>Dotting the I’s.</p>
</div></blockquote>
<p>If a quadrotor undergoes large angular velocities, we cannot ignore gyroscopic effects and we have to modify the rotational dynamics equation above to</p>
<div class="math notranslate nohighlight">
\[
\tau^b = I \dot{\omega}^b - \omega^b \times I \omega^b,
\]</div>
<p>where <span class="math notranslate nohighlight">\(\times\)</span> is the cross-product. The second term is a set of quadratic components in the angular velocity <span class="math notranslate nohighlight">\(\omega^b\)</span> and that is why for small angular velocities they can be ignored. In fact, in many cases the orientation of a quadrotor is <em>actively controlled</em> to stay constant during hovering or in fast forward flight, and it is only in complicated maneuvers that large angular velocities occur.</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="S71_drone_state.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title"><span class="section-number">7.1. </span>Moving in Three Dimensions</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="S73_drone_sensing.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">7.3. </span>Sensing for Drones</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By Frank Dellaert and Seth Hutchinson<br/>
    
        &copy; Copyright 2021.<br/>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>